
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <title>8. API 參考 · Redux-Saga</title>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.0">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-prism/prism.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../../build/gitbook.css">
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    
    <link rel="prev" href="../Glossary.html" />
    

    
        <link rel="shortcut icon" href='../../logo/favicon/favicon.ico' type="image/x-icon">
    
    
        <link rel="bookmark" href='../../logo/favicon/favicon.ico' type="image/x-icon">
    
    
        <link rel="apple-touch-icon" href='../../logo/favicon/apple-touch-icon-152x152.png'>
    
    
        
        <link rel="apple-touch-icon" sizes="120x120" href="../../logo/favicon/apple-touch-icon-120x120.png">
        
        <link rel="apple-touch-icon" sizes="180x180" href="../../logo/favicon/apple-touch-icon-180x180.png">
        
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Read Me
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../introduction/">
            
                <a href="../introduction/">
            
                    
                    1. 介紹
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../introduction/BeginnerTutorial.html">
            
                <a href="../introduction/BeginnerTutorial.html">
            
                    
                    1.1 新手教學
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../introduction/SagaBackground.html">
            
                <a href="../introduction/SagaBackground.html">
            
                    
                    1.2 Saga 概念的背景
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../basics/">
            
                <a href="../basics/">
            
                    
                    2. 基礎概念
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../basics/UsingSagaHelpers.html">
            
                <a href="../basics/UsingSagaHelpers.html">
            
                    
                    2.1 使用 Saga Helpers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../basics/DeclarativeEffects.html">
            
                <a href="../basics/DeclarativeEffects.html">
            
                    
                    2.2 宣告 Effects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../basics/DispatchingActions.html">
            
                <a href="../basics/DispatchingActions.html">
            
                    
                    2.3 Dispatch action
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../basics/ErrorHandling.html">
            
                <a href="../basics/ErrorHandling.html">
            
                    
                    2.4 錯誤處理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../basics/Effect.html">
            
                <a href="../basics/Effect.html">
            
                    
                    2.4 一個常見的抽象概念：Effect
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../advanced/">
            
                <a href="../advanced/">
            
                    
                    3. 進階概念
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../advanced/FutureActions.html">
            
                <a href="../advanced/FutureActions.html">
            
                    
                    3.1 Pull 未來的 action
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../advanced/NonBlockingCalls.html">
            
                <a href="../advanced/NonBlockingCalls.html">
            
                    
                    3.2 非阻塞式的呼叫
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../advanced/RunningTasksInParallel.html">
            
                <a href="../advanced/RunningTasksInParallel.html">
            
                    
                    3.3 同時執行多個任務l
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../advanced/RacingEffects.html">
            
                <a href="../advanced/RacingEffects.html">
            
                    
                    3.4 在多個 Effect 之間啟動一個 race
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../advanced/SequencingSagas.html">
            
                <a href="../advanced/SequencingSagas.html">
            
                    
                    3.5 使用 yield* 對 Saga 做排序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../advanced/ComposingSagas.html">
            
                <a href="../advanced/ComposingSagas.html">
            
                    
                    3.6 組合 Saga
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../advanced/TaskCancellation.html">
            
                <a href="../advanced/TaskCancellation.html">
            
                    
                    3.7 取消 Task
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="../advanced/ForkModel.html">
            
                <a href="../advanced/ForkModel.html">
            
                    
                    3.8 redux-saga 的 fork 模型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9" data-path="../advanced/Concurrency.html">
            
                <a href="../advanced/Concurrency.html">
            
                    
                    3.9 常見的併發模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.10" data-path="../advanced/Testing.html">
            
                <a href="../advanced/Testing.html">
            
                    
                    3.10 Saga 測試的範例
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.11" data-path="../advanced/UsingRunSaga.html">
            
                <a href="../advanced/UsingRunSaga.html">
            
                    
                    3.11 連結 Saga 到外部的輸入和輸出
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.12" data-path="../advanced/Channels.html">
            
                <a href="../advanced/Channels.html">
            
                    
                    3.12 使用 Channel
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../recipes/">
            
                <a href="../recipes/">
            
                    
                    4. Recipes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../ExternalResources.html">
            
                <a href="../ExternalResources.html">
            
                    
                    5. 外部資源
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../Troubleshooting.html">
            
                <a href="../Troubleshooting.html">
            
                    
                    6. 疑難排解
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../Glossary.html">
            
                <a href="../Glossary.html">
            
                    
                    7. 術語表
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.9" data-path="./">
            
                <a href="./">
            
                    
                    8. API 參考
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >8. API 參考</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="api-&#x53C3;&#x8003;">API &#x53C3;&#x8003;</h1><ul><li><p><a href="#middleware-api"><code>Middleware API</code></a></p><ul><li><a href="#createsagamiddlewareoptions"><code>createSagaMiddleware(options)</code></a>
</li>
<li><a href="#middlewarerunsaga-args"><code>middleware.run(saga, ...args)</code></a>
</li></ul>
</li>
<li><p><a href="#saga-helpers"><code>Saga Helpers</code></a></p><ul><li><a href="#takeeverypattern-saga-args"><code>takeEvery(pattern, saga, ...args)</code></a>
</li>
<li><a href="#takeeverychannel-saga-args"><code>takeEvery(channel, saga, ...args)</code></a>
</li>
<li><a href="#takelatestpattern-saga-args"><code>takeLatest(pattern, saga, ..args)</code></a>
</li>
<li><a href="#takelatestchannel-saga-args"><code>takeLatest(channel, saga, ..args)</code></a>
</li>
<li><a href="#throttlems-pattern-saga-args"><code>throttle(ms, pattern, saga, ..args)</code></a>
</li></ul>
</li>
<li><p><a href="#effect-creators"><code>Effect creators</code></a></p><ul><li><a href="#takepattern"><code>take(pattern)</code></a>
</li>
<li><a href="#takemaybepattern"><code>take.maybe(pattern)</code></a>
</li>
<li><a href="#takechannel"><code>take(channel)</code></a>
</li>
<li><a href="#takemaybechannel"><code>take.maybe(channel)</code></a>
</li>
<li><a href="#putaction"><code>put(action)</code></a>
</li>
<li><a href="#putresolveaction"><code>put.resolve(action)</code></a>
</li>
<li><a href="#putchannel-action"><code>put(channel, action)</code></a>
</li>
<li><a href="#callfn-args"><code>call(fn, ...args)</code></a>
</li>
<li><a href="#callcontext-fn-args"><code>call([context, fn], ...args)</code></a>
</li>
<li><a href="#callcontext-fnname-args"><code>call([context, fnName], ...args)</code></a>
</li>
<li><a href="#applycontext-fn-args"><code>apply(context, fn, args)</code></a>
</li>
<li><a href="#cpsfn-args"><code>cps(fn, ...args)</code></a>
</li>
<li><a href="#cpscontext-fn-args"><code>cps([context, fn], ...args)</code></a>
</li>
<li><a href="#forkfn-args"><code>fork(fn, ...args)</code></a>
</li>
<li><a href="#forkcontext-fn-args"><code>fork([context, fn], ...args)</code></a>
</li>
<li><a href="#spawnfn-args"><code>spawn(fn, ...args)</code></a>
</li>
<li><a href="#spawncontext-fn-args"><code>spawn([context, fn], ...args)</code></a>
</li>
<li><a href="#jointask"><code>join(task)</code></a>
</li>
<li><a href="#jointasks"><code>join(...tasks)</code></a>
</li>
<li><a href="#canceltask"><code>cancel(task)</code></a>
</li>
<li><a href="#canceltasks"><code>cancel(...tasks)</code></a>
</li>
<li><a href="#cancel"><code>cancel()</code></a>
</li>
<li><a href="#selectselector-args"><code>select(selector, ...args)</code></a>
</li>
<li><a href="#actionchannelpattern-buffer"><code>actionChannel(pattern, [buffer])</code></a>
</li>
<li><a href="#flushchannel"><code>flush(channel)</code></a>
</li>
<li><a href="#cancelled"><code>cancelled()</code></a>
</li>
<li><a href="#setcontextprops"><code>setContext(props)</code></a>
</li>
<li><a href="#getcontextprop"><code>getContext(prop)</code></a>
</li></ul>
</li>
<li><p><a href="#effect-combinators"><code>Effect combinators</code></a></p><ul><li><a href="#raceeffects"><code>race(effects)</code></a>
</li>
<li><a href="#raceeffects-with-array"><code>race([...effects])</code></a>
</li>
<li><a href="#alleffects---parallel-effects"><code>all([...effects]) (aka parallel effects)</code></a>
</li>
<li><a href="#alleffects"><code>all(effects)</code></a>
</li></ul>
</li>
<li><p><a href="#interfaces"><code>Interfaces</code></a></p><ul><li><a href="#task"><code>Task</code></a>
</li>
<li><a href="#channel"><code>Channel</code></a>
</li>
<li><a href="#buffer"><code>Buffer</code></a>
</li>
<li><a href="#sagamonitor"><code>SagaMonitor</code></a>
</li></ul>
</li>
<li><p><a href="#external-api"><code>External API</code></a></p><ul><li><a href="#runsagaoptions-saga-args"><code>runSaga(options, saga, ...args)</code></a>
</li></ul>
</li>
<li><p><a href="#utils"><code>Utils</code></a></p><ul><li><a href="#channelbuffer"><code>channel([buffer])</code></a>
</li>
<li><a href="#eventchannelsubscribe-buffer-matcher"><code>eventChannel(subscribe, [buffer], matcher)</code></a>
</li>
<li><a href="#buffers"><code>buffers</code></a>
</li>
<li><a href="#delayms-val"><code>delay(ms, [val])</code></a>
</li>
<li><a href="#cloneablegeneratorgeneratorfunc"><code>cloneableGenerator(generatorFunc)</code></a>
</li>
<li><a href="#createmocktask"><code>createMockTask()</code></a>
</li></ul>
</li></ul>
<h1 id="cheatsheets">Cheatsheets</h1><ul><li><a href="#blocking--non-blocking">Blocking / Non-blocking</a>
</li></ul>
<h2 id="middleware-api">Middleware API</h2><h3 id="createsagamiddlewareoptions"><code>createSagaMiddleware(options)</code></h3><p>&#x5EFA;&#x7ACB;&#x4E00;&#x500B; Redux middleware &#x4E26;&#x9023;&#x7D50; Saga &#x5230; Redux Store&#x3002;</p><ul><li><p><code>options: Object</code> - &#x50B3;&#x9001;&#x5230; middleware &#x7684;&#x9078;&#x9805;&#x6E05;&#x55AE;&#xFF0C;&#x76EE;&#x524D;&#x652F;&#x63F4;&#x7684;&#x9078;&#x9805;&#xFF1A;</p><ul><li><p><code>sagaMonitor</code> : <a href="#sagamonitor">SagaMonitor</a> - &#x5982;&#x679C;&#x63D0;&#x4F9B;&#x4E00;&#x500B; Saga Monitor&#xFF0C;middleware &#x5C07;&#x63D0;&#x4F9B;&#x76E3;&#x8996;&#x4E8B;&#x4EF6;&#x7D66; monitor&#x3002;</p></li>
<li><p><code>emitter</code> : &#x5C07; redux &#x7684; action &#x50B3;&#x9001;&#x7D66; redux saga&#xFF08;&#x901A;&#x904E; redux middleware&#xFF09;&#x3002;Emitter &#x662F;&#x4E00;&#x500B; higher order function&#xFF0C;&#x5B83;&#x5167;&#x5EFA;&#x4E00;&#x500B; builtin emitter &#x4E26;&#x56DE;&#x50B3;&#x53E6;&#x4E00;&#x500B; emitter&#x3002;</p><p><strong>&#x7BC4;&#x4F8B;</strong></p><p>&#x5728;&#x4EE5;&#x4E0B;&#x7684;&#x7BC4;&#x4F8B;&#x6211;&#x5011;&#x5EFA;&#x7ACB;&#x4E00;&#x500B; emitter&#xFF0C;&#x5B83;&#x300C;unpack&#x300D;action &#x7684;&#x9663;&#x5217;&#xFF0C;&#x4E26;&#x4E14; emit &#x5F9E;&#x9663;&#x5217;&#x88AB;&#x63D0;&#x53D6;&#x7684; action&#x3002;</p><pre><code class="lang-javascript"> <span class="token function">createSagaMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
   emitter<span class="token punctuation">:</span> emit <span class="token operator">=</span><span class="token operator">&gt;</span> action <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      action<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>emit<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    <span class="token function">emit</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<ul><li><code>logger</code> : Function -  &#x5B9A;&#x7FA9;&#x4E00;&#x500B;&#x81EA;&#x8A02;&#x7684; logger middleware&#x3002;&#x9810;&#x8A2D;&#x4E0A;&#xFF0C;middleware &#x8A18;&#x9304;&#x6240;&#x6709;&#x932F;&#x8AA4;&#x4E26;&#x5728; console &#x4E2D;&#x8B66;&#x544A;&#x3002;&#x544A;&#x8A34; middleware &#x50B3;&#x9001;&#x932F;&#x8AA4;&#x6216;&#x8B66;&#x544A;&#x5230;&#x63D0;&#x4F9B;&#x7684; logger&#x3002;&#x88AB;&#x547C;&#x53EB;&#x7684; logger &#x8207;&#x5B83;&#x7684;&#x53C3;&#x6578; <code>(level, ...args)</code>&#xFF0C;&#x7B2C;&#x4E00;&#x500B;&#x8AAA;&#x660E;&#x8A18;&#x9304;&#x7684;&#x5C64;&#x7D1A;&#xFF1A;(&apos;info&apos;, &apos;warning&apos; or &apos;error&apos;)&#x3002;&#x5176;&#x9918;&#x90E8;&#x5206;&#x5C0D;&#x61C9;&#x65BC;&#x4EE5;&#x4E0B;&#x53C3;&#x6578;&#xFF08;&#x4F60;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>args.join(&apos; &apos;)</code> &#x4F86;&#x9023;&#x63A5;&#x6240;&#x6709;&#x53C3;&#x6578;&#x6210;&#x70BA;&#x4E00;&#x500B;&#x55AE;&#x4E00;&#x7684;&#x5B57;&#x4E32;&#xFF09;&#x3002;
</li></ul>
</li>
<li><p><code>onError</code> : Function - &#x5982;&#x679C;&#x6709;&#x63D0;&#x4F9B;&#x7684;&#x8A71;&#xFF0C;middleware &#x5C07;&#x5F9E; Saga &#x547C;&#x53EB;&#x5B83;&#x8207;&#x672A;&#x6355;&#x7372;&#x932F;&#x8AA4;&#x3002;&#x5C0D;&#x65BC;&#x50B3;&#x9001;&#x672A;&#x6355;&#x7372;&#x4F8B;&#x5916;&#x5230;&#x8FFD;&#x8E64;&#x932F;&#x8AA4;&#x670D;&#x52D9;&#x975E;&#x5E38;&#x6709;&#x7528;&#x3002;</p></li></ul>
</li></ul>
<h4 id="&#x7BC4;&#x4F8B;">&#x7BC4;&#x4F8B;</h4><p>&#x4EE5;&#x4E0B;&#x6211;&#x5011;&#x5C07;&#x5EFA;&#x7ACB;&#x4E00;&#x500B; <code>configureStore</code> function&#xFF0C;&#x589E;&#x5F37; Store &#x4E26;&#x65B0;&#x589E;&#x4E00;&#x500B; <code>runSaga</code> &#x65B9;&#x6CD5;&#x3002;&#x7136;&#x5F8C;&#x5728;&#x6211;&#x5011;&#x4E3B;&#x8981;&#x7684; module &#x4E2D;&#xFF0C;&#x4F7F;&#x7528;&#x9019;&#x500B;&#x65B9;&#x6CD5;&#x4F86;&#x555F;&#x52D5;&#x61C9;&#x7528;&#x7A0B;&#x5F0F;&#x7684; root Saga&#x3002;</p><p><strong>configureStore.js</strong></p><pre><code class="lang-javascript"><span class="token keyword">import</span> createSagaMiddleware from <span class="token string">&apos;redux-saga&apos;</span>
<span class="token keyword">import</span> reducer from <span class="token string">&apos;./path/to/reducer&apos;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">configureStore</span><span class="token punctuation">(</span>initialState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// &#x6CE8;&#x610F;&#xFF1A;&#x5C07; middleware &#x505A;&#x70BA;&#x6700;&#x5F8C;&#x4E00;&#x500B;&#x53C3;&#x6578;&#x50B3;&#x9001;&#x7D66; createStore &#x8981;&#x6C42; redux@&gt;=3.1.0 &#x4EE5;&#x4E0A;&#x7684;&#x7248;&#x672C;</span>
  <span class="token keyword">const</span> sagaMiddleware <span class="token operator">=</span> <span class="token function">createSagaMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialState<span class="token punctuation">,</span> <span class="token function">applyMiddleware</span><span class="token punctuation">(</span><span class="token comment" spellcheck="true">/* other middleware, */</span>sagaMiddleware<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    runSaga<span class="token punctuation">:</span> sagaMiddleware<span class="token punctuation">.</span>run
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p><strong>main.js</strong></p><pre><code class="lang-javascript"><span class="token keyword">import</span> configureStore from <span class="token string">&apos;./configureStore&apos;</span>
<span class="token keyword">import</span> rootSaga from <span class="token string">&apos;./sagas&apos;</span>
<span class="token comment" spellcheck="true">// ... &#x5176;&#x4ED6; imports</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">configureStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
store<span class="token punctuation">.</span><span class="token function">runSaga</span><span class="token punctuation">(</span>rootSaga<span class="token punctuation">)</span></code></pre>
<h4 id="&#x6CE8;&#x610F;">&#x6CE8;&#x610F;</h4><p>&#x89C0;&#x5BDF;&#x4EE5;&#x4E0B;&#x5728; <code>sagaMiddleware.run</code> &#x65B9;&#x6CD5;&#x7684;&#x66F4;&#x591A;&#x8CC7;&#x8A0A;&#x3002;</p><h3 id="middlewarerunsaga-args"><code>middleware.run(saga, ...args)</code></h3><p>&#x53EA;&#x5728; <code>applyMiddleware</code> &#x968E;&#x6BB5;<strong>&#x4E4B;&#x5F8C;</strong>&#x52D5;&#x614B;&#x57F7;&#x884C; Saga&#x3002;</p><ul><li><code>saga: Function</code>: &#x4E00;&#x500B; Generator function
</li>
<li><code>args: Array<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>any</span><span class="token punctuation">&gt;</span></span></code>: &#x63D0;&#x4F9B;&#x7D66; <code>saga</code> &#x7684;&#x53C3;&#x6578;
</li></ul>
<p>&#x9019;&#x500B;&#x65B9;&#x6CD5;&#x56DE;&#x50B3;&#x4E00;&#x500B; <a href="#task-descriptor">Task descriptor</a>&#x3002;</p><h4 id="&#x6CE8;&#x610F;">&#x6CE8;&#x610F;</h4><p><code>saga</code> &#x5FC5;&#x9808;&#x662F;&#x4E00;&#x500B; function &#x4E14;&#x56DE;&#x50B3;&#x4E00;&#x500B; <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Generator" target="_blank">Generator &#x7269;&#x4EF6;</a>&#x3002;middleware &#x5C07;&#x8FED;&#x4EE3; Generator &#x4E26;&#x57F7;&#x884C;&#x6240;&#x6709;&#x88AB; yield &#x7684; Effect&#x3002;</p><p><code>saga</code> &#x53EF;&#x80FD;&#x4E5F;&#x4F7F;&#x7528; library &#x63D0;&#x4F9B;&#x7684;&#x5404;&#x7A2E; Effect &#x4F86;&#x555F;&#x52D5;&#x5176;&#x4ED6; saga&#x3002;&#x8FED;&#x4EE3;&#x8655;&#x7406;&#x7A0B;&#x5E8F;&#x4E5F;&#x4F7F;&#x7528;&#x65BC;&#x4E0B;&#x9762;&#x6240;&#x6709;&#x7684;&#x5B50; saga&#x3002;</p><p>&#x5728;&#x7B2C;&#x4E00;&#x500B;&#x8FED;&#x4EE3;&#xFF0C;middleware &#x8ABF;&#x7528; <code>next()</code> &#x65B9;&#x6CD5;&#x4F86;&#x53D6;&#x5F97;&#x4E0B;&#x4E00;&#x500B; Effect&#xFF0C;&#x7136;&#x5F8C; middleware &#x900F;&#x904E; Effect API &#x57F7;&#x884C;&#x88AB;&#x6307;&#x5B9A;&#x7684; yield Effect&#x3002;&#x5728;&#x9019;&#x500B;&#x540C;&#x6642;&#xFF0C;Generator &#x5C07;&#x66AB;&#x505C;&#x76F4;&#x5230; effect &#x7D50;&#x675F;&#x57F7;&#x884C;&#x3002;&#x6536;&#x5230;&#x7684;&#x57F7;&#x884C;&#x7D50;&#x679C;&#x5F8C;&#xFF0C;middleware &#x5728; Generator &#x547C;&#x53EB; <code>next(result)</code>&#xFF0C;&#x5C07;&#x5B83;&#x53D6;&#x5F97;&#x7D50;&#x679C;&#x4F5C;&#x70BA;&#x53C3;&#x6578;&#x50B3;&#x9001;&#x3002;&#x6216;&#x62CB;&#x51FA;&#x4E00;&#x4E9B;&#x932F;&#x8AA4;&#x3002;</p><p>&#x76F8;&#x53CD;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x57F7;&#x884C;&#x7D50;&#x679C;&#x662F;&#x4E00;&#x500B;&#x932F;&#x8AA4; (&#x6839;&#x64DA;&#x6BCF;&#x500B; Effect creator &#x7684;&#x6307;&#x5B9A;)&#xFF0C;Generator &#x7684; <code>throw(error)</code> &#x6703;&#x88AB;&#x547C;&#x53EB;&#xFF0C;&#x5982;&#x679C; Generator function yield &#x6307;&#x4EE4;&#x5728; <code>try/catch</code> &#x5340;&#x584A;&#xFF0C;&#x900F;&#x904E; runtime &#x7684; Generator &#x8ABF;&#x7528; <code>catch</code> &#x5340;&#x584A;&#xFF0C;runtime &#x4E5F;&#x6703;&#x8ABF;&#x7528;&#x4EFB;&#x4F55;&#x5C0D;&#x61C9;&#x7684; finally &#x5340;&#x584A;&#x3002;</p><p>&#x5728; Saga &#x88AB;&#x53D6;&#x6D88;&#x7684;&#x60C5;&#x6CC1;&#xFF08;&#x4E5F;&#x8A31;&#x662F;&#x624B;&#x52D5;&#x6216;&#x662F;&#x4F7F;&#x7528;&#x63D0;&#x4F9B;&#x7684; Effect&#xFF09;&#xFF0C;middleware &#x5C07;&#x8ABF;&#x7528; Generator &#x7684; <code>return()</code> &#x65B9;&#x6CD5;&#x3002;&#x9019;&#x6703;&#x9020;&#x6210; Generator &#x8DF3;&#x904E;&#x76EE;&#x524D;&#x7684; finally &#x5340;&#x584A;&#x3002;</p><h2 id="saga-helpers">Saga Helpers</h2><blockquote><p>&#x6CE8;&#x610F;&#xFF1A;&#x4EE5;&#x4E0B; function &#x662F; helper function &#x5EFA;&#x7ACB;&#x5728; Effect creator &#x4E4B;&#x4E0B;&#x3002;</p></blockquote><h3 id="takeeverypattern-saga-args"><code>takeEvery(pattern, saga, ...args)</code></h3><p>&#x6BCF;&#x6B21; dispatch &#x7684; action &#x7B26;&#x5408; <code>pattern</code> &#x6642;&#xFF0C;&#x7522;&#x751F;&#x4E00;&#x500B; <code>saga</code>&#x3002;</p><ul><li><p><code>pattern: String | Array | Function</code> - &#x66F4;&#x591A;&#x8CC7;&#x8A0A;&#x8ACB;&#x53C3;&#x8003; <a href="#takepattern"><code>take(pattern)</code></a> &#x6587;&#x4EF6;</p></li>
<li><p><code>saga: Function</code> - &#x4E00;&#x500B; Generator function</p></li>
<li><p><code>args: Array<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>any</span><span class="token punctuation">&gt;</span></span></code> - &#x555F;&#x52D5; task &#x6642;&#x50B3;&#x9001;&#x7684;&#x53C3;&#x6578;&#x3002;<code>takeEvery</code> &#x5C07;&#x50B3;&#x5165;&#x7684; action &#x52A0;&#x5165;&#x5230;&#x53C3;&#x6578;&#x5217;&#x8868;&#xFF08;&#x610F;&#x601D;&#x8AAA;&#xFF0C;action &#x5C07;&#x505A;&#x70BA;&#x6700;&#x5F8C;&#x4E00;&#x500B;&#x53C3;&#x6578;&#x63D0;&#x4F9B;&#x7D66; <code>saga</code>&#xFF09;</p></li></ul>
<h4 id="&#x7BC4;&#x4F8B;">&#x7BC4;&#x4F8B;</h4><p>&#x4EE5;&#x4E0B;&#x7BC4;&#x4F8B;&#xFF0C;&#x6211;&#x5011;&#x5EFA;&#x7ACB;&#x4E00;&#x500B;&#x7C21;&#x55AE;&#x7684; <code>fetchUser</code> task&#xFF0C;&#x5728;&#x6BCF;&#x6B21; dispatch <code>USER_REQUESTED</code> action &#x6642;&#xFF0C;&#x4F7F;&#x7528; <code>takeEvery</code> &#x4F86;&#x555F;&#x52D5;&#x4E00;&#x500B;&#x65B0;&#x7684; <code>fetchUser</code> task&#xFF1A;</p><pre><code class="lang-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> takeEvery <span class="token punctuation">}</span> from `redux<span class="token operator">-</span>saga<span class="token operator">/</span>effects`

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">fetchUser</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">watchFetchUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token function">takeEvery</span><span class="token punctuation">(</span><span class="token string">&apos;USER_REQUESTED&apos;</span><span class="token punctuation">,</span> fetchUser<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<h4 id="&#x6CE8;&#x610F;">&#x6CE8;&#x610F;</h4><p><code>takeEvery</code> &#x662F;&#x4E00;&#x500B;&#x9AD8;&#x968E; API&#xFF0C;&#x4F7F;&#x7528; <code>take</code> &#x548C; <code>fork</code> &#x5EFA;&#x7ACB;&#x3002;&#x9019;&#x88E1;&#x662F;&#x5982;&#x4F55;&#x4F7F;&#x7528;&#x4F4E;&#x968E; Effects &#x5BE6;&#x4F5C; helper</p><pre><code class="lang-javascript"><span class="token keyword">const</span> takeEvery <span class="token operator">=</span> <span class="token punctuation">(</span>patternOrChannel<span class="token punctuation">,</span> saga<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>args<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token keyword">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> action <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">take</span><span class="token punctuation">(</span>patternOrChannel<span class="token punctuation">)</span>
    <span class="token keyword">yield</span> <span class="token function">fork</span><span class="token punctuation">(</span>saga<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>args<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p><code>takeEvery</code> &#x5141;&#x8A31;&#x8655;&#x7406;&#x4F75;&#x767C;&#x7684; action&#x3002;&#x5728;&#x4E0A;&#x9762;&#x7684;&#x7BC4;&#x4F8B;&#x4E2D;&#xFF0C;&#x7576;&#x4E00;&#x500B; <code>USER_REQUESTED</code> action &#x88AB; dispatch&#xFF0C;&#x65B0;&#x7684; <code>fetchUser</code> task &#x6703;&#x88AB;&#x555F;&#x52D5;&#xFF0C;&#x5373;&#x4F7F;&#x4E4B;&#x524D;&#x7684; <code>fetchUser</code> &#x9084;&#x5728;&#x7B49;&#x5F85;&#xFF08;&#x4F8B;&#x5982;&#xFF0C;&#x4F7F;&#x7528;&#x8005;&#x5FEB;&#x901F;&#x7684;&#x5728;&#x4E00;&#x500B; <code>Load User</code> &#x6309;&#x9215;&#x6309;&#x4E86;&#x5169;&#x6B21;&#xFF0C;&#x7B2C;&#x4E8C;&#x6B21;&#x9EDE;&#x64CA;&#x4ECD;&#x7136;&#x6703; dispatch &#x4E00;&#x500B; <code>USER_REQUESTED</code> action&#xFF0C;&#x5373;&#x4F7F;&#x7B2C;&#x4E00;&#x500B;&#x89F8;&#x767C;&#x7684; <code>fetchUser</code> &#x9084;&#x6C92;&#x7D50;&#x675F;&#xFF09;&#x3002;</p><p><code>takeEvery</code> &#x4E0D;&#x6703;&#x8655;&#x7406;&#x591A;&#x500B; task &#x7684; response &#x6392;&#x5E8F;&#x3002;&#x9019;&#x4E0D;&#x6703;&#x4FDD;&#x8B49; task &#x6309;&#x7167;&#x555F;&#x52D5;&#x7684;&#x9806;&#x5E8F;&#x7D50;&#x675F;&#xFF0C;&#x5982;&#x679C;&#x8981;&#x8655;&#x7406; response &#x7684;&#x6392;&#x5E8F;&#xFF0C;&#x4F60;&#x53EF;&#x80FD;&#x8003;&#x616E;&#x4EE5;&#x4E0B;&#x7684; <code>takeLatest</code>&#x3002;</p><h3 id="takeeverychannel-saga-args"><code>takeEvery(channel, saga, ...args)</code></h3><p>&#x4F60;&#x4E5F;&#x53EF;&#x4EE5;&#x50B3;&#x9001;&#x4E00;&#x500B; channel &#x4F5C;&#x70BA;&#x53C3;&#x6578;&#x548C;&#x884C;&#x70BA;&#xFF0C;&#x76F8;&#x540C;&#x65BC; <a href="#takeeverypattern-saga-args">takeEvery(pattern, saga, ...args)</a>&#x3002;</p><h3 id="takeeverychannel-saga-args"><code>takeEvery(channel, saga, ...args)</code></h3><p>You can also pass in a channel as argument and the behaviour is the same as <a href="#takeeverypattern-saga-args">takeEvery(pattern, saga, ...args)</a>.</p><h3 id="takelatestpattern-saga-args"><code>takeLatest(pattern, saga, ...args)</code></h3><p>&#x5728;&#x6BCF;&#x6B21; dispatch &#x7684; action &#x548C;&#x7B26;&#x5408; <code>pattern</code> &#x6642;&#xFF0C;&#x7522;&#x751F;&#x4E00;&#x500B; <code>saga</code>&#xFF0C;&#x4E26;&#x81EA;&#x52D5;&#x53D6;&#x6D88;&#x5148;&#x524D;&#x555F;&#x52D5;&#x800C;&#x4E14;&#x53EF;&#x80FD;&#x5728;&#x57F7;&#x884C;&#x7684; <code>saga</code>&#x3002;</p><p>&#x5728;&#x6BCF;&#x6B21; action &#x7B26;&#x5408; <code>pattern</code>&#xFF0C;&#x800C;&#x4E14;&#x88AB; dispatch &#x5230; store &#x6642;&#xFF0C;<code>takeLatest</code> &#x6703;&#x5728;&#x80CC;&#x666F;&#x555F;&#x52D5;&#x4E00;&#x500B;&#x65B0;&#x7684; <code>saga</code>&#xFF0C;&#x5982;&#x679C; <code>saga</code> task &#x5728;&#x5148;&#x524D;&#x88AB;&#x555F;&#x52D5;&#xFF08;&#x5728;&#x6700;&#x5F8C;&#x88AB; dispatch action &#x4E4B;&#x524D;&#x5BE6;&#x969B;&#x7684; action&#xFF09;&#xFF0C;task &#x4ECD;&#x7136;&#x6703;&#x88AB;&#x53D6;&#x6D88;&#x3002;</p><ul><li><p><code>pattern: String | Array | Function</code> - &#x66F4;&#x591A;&#x8CC7;&#x8A0A;&#x8ACB;&#x53C3;&#x8003; <a href="#takepattern"><code>take(pattern)</code></a> &#x6587;&#x4EF6;</p></li>
<li><p><code>saga: Function</code> - &#x4E00;&#x500B; Generator function</p></li>
<li><p><code>args: Array<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>any</span><span class="token punctuation">&gt;</span></span></code> - &#x555F;&#x52D5; task &#x6642;&#x50B3;&#x9001;&#x7684;&#x53C3;&#x6578;&#x3002;<code>takeLatest</code> &#x5C07;&#x50B3;&#x5165;&#x7684; action &#x52A0;&#x5165;&#x5230;&#x53C3;&#x6578;&#x5217;&#x8868;&#xFF08;&#x610F;&#x601D;&#x8AAA;&#xFF0C;action &#x5C07;&#x505A;&#x70BA;&#x6700;&#x5F8C;&#x4E00;&#x500B;&#x53C3;&#x6578;&#x63D0;&#x4F9B;&#x7D66; <code>saga</code>&#xFF09;</p></li></ul>
<h4 id="&#x7BC4;&#x4F8B;">&#x7BC4;&#x4F8B;</h4><p>&#x5728;&#x4EE5;&#x4E0B;&#x7684;&#x7BC4;&#x4F8B;&#xFF0C;&#x6211;&#x5011;&#x5EFA;&#x7ACB;&#x4E00;&#x500B;&#x7C21;&#x55AE;&#x7684; <code>fetchUser</code> task&#xFF0C;&#x5728;&#x6BCF;&#x6B21; dispatch <code>USER_REQUESTED</code> action &#x6642;&#xFF0C;&#x4F7F;&#x7528; <code>takeLatest</code> &#x4F86;&#x555F;&#x52D5;&#x4E00;&#x500B;&#x65B0;&#x7684; <code>fetchUser</code> task&#x3002;&#x7531;&#x65BC; <code>takeLatest</code> &#x53D6;&#x6D88;&#x4EFB;&#x4F55;&#x5148;&#x524D;&#x555F;&#x52D5;&#x7B49;&#x5F85;&#x7684; task&#xFF0C;&#x6211;&#x5011;&#x8981;&#x78BA;&#x4FDD;&#x5982;&#x679C;&#x4F7F;&#x7528;&#x8005;&#x5FEB;&#x901F;&#x89F8;&#x767C;&#x591A;&#x500B; <code>USER_REQUESTED</code> action &#x6642;&#xFF0C;&#x53EA;&#x6703;&#x5F97;&#x5230;&#x6700;&#x5F8C;&#x4E00;&#x500B; action&#x3002;</p><pre><code class="lang-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> takeLatest <span class="token punctuation">}</span> from `redux<span class="token operator">-</span>saga<span class="token operator">/</span>effects`

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">fetchUser</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">watchLastFetchUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token function">takeLatest</span><span class="token punctuation">(</span><span class="token string">&apos;USER_REQUESTED&apos;</span><span class="token punctuation">,</span> fetchUser<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<h4 id="&#x6CE8;&#x610F;">&#x6CE8;&#x610F;</h4><p><code>takeLatest</code> &#x662F;&#x4E00;&#x500B;&#x9AD8;&#x968E; API&#xFF0C;&#x4F7F;&#x7528; <code>take</code> &#x548C; <code>fork</code> &#x5EFA;&#x7ACB;&#x3002;&#x9019;&#x88E1;&#x662F;&#x5982;&#x4F55;&#x4F7F;&#x7528;&#x4F4E;&#x968E; Effects &#x5BE6;&#x4F5C; helper</p><pre><code class="lang-javascript"><span class="token keyword">const</span> takeLatest <span class="token operator">=</span> <span class="token punctuation">(</span>patternOrChannel<span class="token punctuation">,</span> saga<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>args<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> lastTask
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token keyword">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> action <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">take</span><span class="token punctuation">(</span>patternOrChannel<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>lastTask<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">yield</span> <span class="token function">cancel</span><span class="token punctuation">(</span>lastTask<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// &#x5982;&#x679C; task &#x5DF2;&#x7D93;&#x7D50;&#x675F;&#xFF0C;cancel &#x662F;&#x4E00;&#x500B;&#x7A7A;&#x64CD;&#x4F5C;</span>
    <span class="token punctuation">}</span>
    lastTask <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">fork</span><span class="token punctuation">(</span>saga<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>args<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<h3 id="takelatestchannel-saga-args"><code>takeLatest(channel, saga, ...args)</code></h3><p>You can also pass in a channel as argument and the behaviour is the same as <a href="#takelatestpattern-saga-args">takeLatest(pattern, saga, ...args)</a>.</p><h3 id="throttlems-pattern-saga-args"><code>throttle(ms, pattern, saga, ...args)</code></h3><p>&#x5728;&#x4E00;&#x500B; action &#x7B26;&#x5408; <code>pattern</code> &#x88AB; dispatch &#x5230; Store &#x7522;&#x751F;&#x4E00;&#x500B; <code>saga</code>&#x3002;&#x5728;&#x7522;&#x751F;&#x4E00;&#x500B; task &#x5F8C;&#xFF0C;&#x5B83;&#x4ECD;&#x7136;&#x63A5;&#x53D7;&#x50B3;&#x5165;&#x7684; action &#x5230;&#x5E95;&#x5C64;&#x7684; <code>buffer</code>&#xFF0C;&#x6700;&#x591A;&#x4FDD;&#x7559;&#x4E00;&#x500B;&#xFF08;&#x6700;&#x8FD1;&#x50B3;&#x5165;&#x7684;&#xFF09;&#xFF0C;&#x4F46;&#x5728;&#x540C;&#x4E00;&#x6642;&#x9593;&#x5167;&#xFF0C;&#x4FDD;&#x6709; <code>ms</code> &#x6BEB;&#x79D2;&#x7522;&#x751F;&#x65B0;&#x7684; task&#xFF08;&#x56E0;&#x6B64;&#x5B83;&#x7684;&#x540D;&#x7A31;&#x70BA; - <code>throttle</code>&#xFF09;&#x3002; &#x76EE;&#x7684;&#x662F;&#x70BA;&#x4E86;&#x5C0D;&#x65BC;&#x5728;&#x7D66;&#x5B9A;&#x6642;&#x9593;&#x5167;&#x6B63;&#x5728;&#x8655;&#x7406;&#x7684; task&#xFF0C;&#x800C;&#x5FFD;&#x7565;&#x50B3;&#x5165;&#x7684; action&#x3002;</p><ul><li><p><code>ms: Number</code> - &#x6642;&#x9593;&#x7A97;&#x53E3;&#x7684;&#x9577;&#x5EA6;&#xFF08;&#x4EE5;&#x6BEB;&#x79D2;&#x70BA;&#x55AE;&#x4F4D;&#xFF09;&#xFF0C;&#x5728; action &#x958B;&#x59CB;&#x8655;&#x7406;&#x4E4B;&#x5F8C;&#xFF0C;&#x5C07;&#x5FFD;&#x7565;&#x5176;&#x4ED6; action</p></li>
<li><p><code>pattern: String | Array | Function</code> - &#x66F4;&#x591A;&#x8CC7;&#x8A0A;&#x8ACB;&#x53C3;&#x8003; <a href="#takepattern"><code>take(pattern)</code></a> &#x6587;&#x4EF6;</p></li>
<li><p><code>saga: Function</code> - &#x4E00;&#x500B; Generator function</p></li>
<li><p><code>args: Array<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>any</span><span class="token punctuation">&gt;</span></span></code> - &#x50B3;&#x9001;&#x7D66;&#x88AB;&#x555F;&#x52D5; task &#x7684;&#x53C3;&#x6578;&#x3002;<code>throttle</code> &#x5C07;&#x6703;&#x65B0;&#x589E;&#x50B3;&#x5165; action &#x5230;&#x53C3;&#x6578; list&#xFF08;&#x610F;&#x601D;&#x662F;&#xFF0C;action &#x5C07;&#x6703;&#x662F;&#x6700;&#x5F8C;&#x4E00;&#x500B;&#x53C3;&#x6578;&#xFF0C;&#x63D0;&#x4F9B;&#x7D66; <code>saga</code>&#xFF09;</p></li></ul>
<h4 id="&#x7BC4;&#x4F8B;">&#x7BC4;&#x4F8B;</h4><p>&#x5728;&#x4EE5;&#x4E0B;&#x7684;&#x7BC4;&#x4F8B;&#xFF0C;&#x6211;&#x5011;&#x5EFA;&#x7ACB;&#x4E00;&#x500B;&#x7C21;&#x55AE;&#x7684; <code>fetchAutocomplete</code> task&#x3002;&#x7576; <code>FETCH_AUTOCOMPLETE</code> action &#x88AB; dispatch &#x6642;&#xFF0C;&#x6211;&#x5011;&#x4F7F;&#x7528; <code>throttle</code> &#x4F86;&#x555F;&#x52D5;&#x4E00;&#x500B;&#x65B0;&#x7684; <code>fetchAutocomplete</code> task&#x3002;&#x7531;&#x65BC; <code>throttle</code> &#x5FFD;&#x7565;&#x4E00;&#x6BB5;&#x6642;&#x9593;&#x5167;&#x9023;&#x7E8C;&#x7684; <code>FETCH_AUTOCOMPLETE</code>&#xFF0C;&#x6211;&#x5011;&#x8981;&#x78BA;&#x4FDD;&#x4F7F;&#x7528;&#x8005;&#x4E0D;&#x6703;&#x5411;&#x4F7F;&#x7528;&#x8005;&#x50B3;&#x9001;&#x5927;&#x91CF;&#x7684; request&#x3002;</p><pre><code class="lang-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> call<span class="token punctuation">,</span> put<span class="token punctuation">,</span> throttle <span class="token punctuation">}</span> from `redux<span class="token operator">-</span>saga<span class="token operator">/</span>effects`

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">fetchAutocomplete</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> autocompleteProposals <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">call</span><span class="token punctuation">(</span>Api<span class="token punctuation">.</span>fetchAutocomplete<span class="token punctuation">,</span> action<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
  <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token punctuation">:</span> <span class="token string">&apos;FETCHED_AUTOCOMPLETE_PROPOSALS&apos;</span><span class="token punctuation">,</span> proposals<span class="token punctuation">:</span> autocompleteProposals<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">throttleAutocomplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">&apos;FETCH_AUTOCOMPLETE&apos;</span><span class="token punctuation">,</span> fetchAutocomplete<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<h4 id="&#x6CE8;&#x610F;">&#x6CE8;&#x610F;</h4><p><code>throttle</code> &#x662F;&#x4E00;&#x500B;&#x4F7F;&#x7528;&#x5167;&#x5EFA;&#x7684; <code>take</code>&#x3001;<code>fork</code> &#x548C; <code>actionChannel</code> &#x7684; high-level API&#x3002;&#x9019;&#x88E1;&#x5982;&#x4F55;&#x4F7F;&#x7528; low-level Effect &#x5BE6;&#x4F5C; helper</p><pre><code class="lang-javascript"><span class="token keyword">const</span> throttle <span class="token operator">=</span> <span class="token punctuation">(</span>ms<span class="token punctuation">,</span> pattern<span class="token punctuation">,</span> task<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>args<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> throttleChannel <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">actionChannel</span><span class="token punctuation">(</span>pattern<span class="token punctuation">)</span>

  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token keyword">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> action <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">take</span><span class="token punctuation">(</span>throttleChannel<span class="token punctuation">)</span>
    <span class="token keyword">yield</span> <span class="token function">fork</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>args<span class="token punctuation">,</span> action<span class="token punctuation">)</span>
    <span class="token keyword">yield</span> <span class="token function">call</span><span class="token punctuation">(</span>delay<span class="token punctuation">,</span> ms<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="effect-creators">Effect creators</h2><blockquote><p>&#x6CE8;&#x610F;&#xFF1A;</p><ul><li>&#x4EE5;&#x4E0B;&#x6BCF;&#x500B; function &#x56DE;&#x50B3;&#x4E00;&#x500B;&#x7D14; JavaScript &#x7269;&#x4EF6;&#x800C;&#x4E14;&#x4E0D;&#x57F7;&#x884C;&#x4EFB;&#x4F55;&#x64CD;&#x4F5C;&#x3002;
</li>
<li>&#x57F7;&#x884C;&#x662F;&#x7531; middleware &#x5728;&#x4E0A;&#x8FF0;&#x8FED;&#x4EE3;&#x8655;&#x7406;&#x904E;&#x7A0B;&#x4E2D;&#x9032;&#x884C;&#x7684;&#x3002;
</li>
<li>middleware &#x6AA2;&#x67E5;&#x6BCF;&#x500B; Effect &#x7684;&#x63CF;&#x8FF0;&#x4E26;&#x57F7;&#x884C;&#x5C0D;&#x61C9;&#x7684; action&#x3002;
</li></ul>
</blockquote><h3 id="takepattern"><code>take(pattern)</code></h3><p>&#x5EFA;&#x7ACB;&#x4E00;&#x500B; Effect &#x63CF;&#x8FF0;&#xFF0C;&#x6307;&#x793A; middleware &#x5728; Store &#x7B49;&#x5F85;&#x6307;&#x5B9A;&#x7684; action&#x3002;
Generator &#x6703;&#x66AB;&#x505C;&#xFF0C;&#x76F4;&#x5230;&#x4E00;&#x500B;&#x7B26;&#x5408; <code>pattern</code> &#x7684; action &#x88AB; dispatch&#x3002;</p><p>&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x898F;&#x5247;&#x4F86;&#x89E3;&#x91CB; <code>pattern</code>&#xFF1A;</p><ul><li><p>&#x5982;&#x679C; <code>take</code> &#x53C3;&#x6578;&#x70BA;&#x7A7A;&#x6216;&#x8005;&#x70BA; <code>&apos;*&apos;</code>&#xFF0C;&#x6240;&#x6709;&#x88AB; dispatch &#x7684; action &#x90FD;&#x7B26;&#x5408;&#xFF08;&#x4F8B;&#x5982;&#xFF1A;<code>take()</code> &#x5C07;&#x7B26;&#x5408;&#x6240;&#x6709; action&#xFF09;&#x3002;</p></li>
<li><p>&#x5982;&#x679C;&#x662F;&#x4E00;&#x500B; function&#xFF0C;<code>pattern(action)</code> &#x70BA; true &#x6642;&#xFF0C;action &#x624D;&#x7B26;&#x5408;&#xFF08;&#x4F8B;&#x5982;&#xFF1A;<code>take(action =&gt; action.entities)</code> &#x5C07;&#x7B26;&#x5408;&#x6240;&#x6709; <code>entities</code> &#x6B04;&#x4F4D;&#x70BA; true &#x7684; action&#xFF09;&#x3002;</p><blockquote><p>&#x6CE8;&#x610F;&#xFF1A;&#x5982;&#x679C; pattern function &#x6709;&#x5B9A;&#x7FA9; <code>toString</code>&#xFF0C;<code>action.type</code> &#x5C07;&#x6703;&#x91DD;&#x5C0D; <code>pattern.toString()</code> &#x6E2C;&#x8A66;&#x3002;&#x5982;&#x679C;&#x4F60;&#x4F7F;&#x7528; action creator library &#x50CF;&#x662F; redux-act &#x6216; redux-actions &#x975E;&#x5E38;&#x6709;&#x7528;&#x3002;</p></blockquote></li>
<li><p>&#x5982;&#x679C;&#x662F;&#x4E00;&#x500B;&#x5B57;&#x4E32;&#xFF0C;&#x7576; <code>action.type === pattern</code> &#x70BA; true &#x6642;&#xFF0C;action &#x624D;&#x7B26;&#x5408;&#xFF08;&#x4F8B;&#x5982;&#xFF1A;<code>take(INCREMENT_ASYNC)</code>&#xFF09;&#x3002;</p></li>
<li><p>&#x5982;&#x679C;&#x5B83;&#x662F;&#x4E00;&#x500B;&#x9663;&#x5217;&#xFF0C;&#x6BCF;&#x500B;&#x5728;&#x9663;&#x5217;&#x5167;&#x7684;&#x5143;&#x7D20;&#x7B26;&#x5408;&#x5148;&#x524D;&#x63D0;&#x5230;&#x7684;&#x898F;&#x5247;&#xFF0C;&#x5B83;&#x652F;&#x63F4; function predicates &#x548C; string &#x7684;&#x6DF7;&#x5408;&#x9663;&#x5217;&#x3002;&#x6700;&#x5E38;&#x898B;&#x7684;&#x4F7F;&#x7528;&#x60C5;&#x6CC1;&#x662F;&#x5B57;&#x4E32;&#x9663;&#x5217;&#xFF0C;&#x6240;&#x4EE5; <code>action.type</code> &#x7B26;&#x5408;&#x9663;&#x5217;&#x5167;&#x6240;&#x6709;&#x7684;&#x5143;&#x7D20;&#xFF08;&#x610F;&#x601D;&#x662F;&#xFF0C;<code>take([INCREMENT, DECREMENT])</code> &#x6703;&#x7B26;&#x5408; type <code>INCREMENT</code> &#x6216;&#x662F; <code>DECREMENT</code> &#x7684; action&#x3002;&#xFF09;&#x3002;</p></li></ul>
<p>middleware &#x63D0;&#x4F9B;&#x4E00;&#x500B;&#x7279;&#x5225;&#x7684; <code>END</code> action&#x3002;&#x5982;&#x679C;&#x4F60; dispatch END action&#xFF0C;&#x6240;&#x6709; Saga &#x88AB;&#x963B;&#x585E;&#x5728; take Effect&#xFF0C;&#x4E0D;&#x8AD6;&#x6307;&#x5B9A;&#x7684; pattern &#x662F;&#x4EC0;&#x9EBC;&#x90FD;&#x6703;&#x88AB;&#x7D50;&#x675F;&#x3002;&#x5982;&#x679C;&#x88AB;&#x7D50;&#x675F;&#x7684; Saga &#x9084;&#x6709;&#x5176;&#x4ED6;&#x88AB; fork &#x7684; task &#x6703;&#x7E7C;&#x7E8C;&#x57F7;&#x884C;&#xFF0C;&#x5B83;&#x5728;&#x7D50;&#x675F; Task &#x4E4B;&#x524D;&#xFF0C;&#x7B49;&#x5F85;&#x6240;&#x6709;&#x5B50; task &#x7D50;&#x675F;&#x3002;</p><h3 id="takemaybepattern"><code>take.maybe(pattern)</code></h3><p>&#x8207; <code>take(pattern)</code> &#x4E00;&#x6A23;&#xFF0C;&#x4F46;&#x662F;&#x4E0D;&#x6703;&#x5728; <code>END</code> action &#x81EA;&#x52D5;&#x7D50;&#x675F; Saga&#x3002;&#x76F8;&#x53CD;&#x7684;&#xFF0C;&#x6240;&#x6709; Saga &#x5728;&#x53D6;&#x5F97; <code>END</code> &#x7269;&#x4EF6;&#x6642;&#x88AB;&#x963B;&#x585E;&#x518D; take Effect&#x3002;</p><h4 id="&#x6CE8;&#x610F;">&#x6CE8;&#x610F;</h4><p><code>take.maybe</code> &#x7684;&#x540D;&#x7A31;&#x4F86;&#x81EA; FP &#x7684; analogy - &#x5B83;&#x4E0D;&#x662F;&#x56DE;&#x50B3;&#x4E00;&#x500B; <code>ACTION</code> type&#xFF08;&#x8207;&#x81EA;&#x52D5;&#x8655;&#x7406;&#xFF09;&#xFF0C;&#x6211;&#x5011;&#x53EF;&#x4EE5;&#x6709;&#x4E00;&#x500B; <code>Maybe(ACTION)</code> type&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x5011;&#x53EF;&#x4EE5;&#x8655;&#x7406;&#x5169;&#x7A2E;&#x60C5;&#x6CC1;&#xFF1A;</p><ul><li>&#x7576;&#x5B83;&#x662F;&#x4E00;&#x500B; <code>Just(ACTION)</code> &#x60C5;&#x6CC1;&#xFF08;&#x6211;&#x5011;&#x6709;&#x4E00;&#x500B; action&#xFF09;
</li>
<li><p><code>NOTHING</code> &#x7684;&#x60C5;&#x6CC1;&#xFF08;channel &#x88AB;&#x95DC;&#x9589;*&#xFF09;&#x3002;&#x610F;&#x601D;&#x662F;&#xFF0C;&#x6211;&#x5011;&#x9700;&#x8981;&#x4E00;&#x4E9B;&#x65B9;&#x6CD5;&#x4F86; map <code>END</code></p></li>
<li><p>&#x7576; <code>dispatch(END)</code> &#x767C;&#x751F;&#x6642;&#xFF0C;&#x5167;&#x90E8;&#x6240;&#x6709;&#x901A;&#x904E; <code>stdChannel</code> &#x88AB; <code>dispatch</code> &#x7684; action &#x6703;&#x88AB;&#x95DC;&#x9589;</p></li></ul>
<h3 id="takechannel"><code>take(channel)</code></h3><p>&#x5EFA;&#x7ACB;&#x4E00;&#x500B; Effect &#x63CF;&#x8FF0;&#xFF0C;&#x6307;&#x793A; middleware &#x5F9E;&#x63D0;&#x4F9B;&#x7684; Channel &#x7B49;&#x5F85;&#x6307;&#x5B9A;&#x7684;&#x8A0A;&#x606F;&#x3002;&#x5982;&#x679C; channel &#x5DF2;&#x7D93;&#x95DC;&#x9589;&#xFF0C;Generator &#x6703;&#x4F9D;&#x7167;&#x4E0A;&#x9762;&#x7684; <code>take(pattern)</code> &#x8655;&#x7406;&#x63CF;&#x8FF0;&#x7ACB;&#x5373;&#x7D50;&#x675F;&#x3002;</p><h3 id="takemaybechannel"><code>take.maybe(channel)</code></h3><p>&#x76F8;&#x540C;&#x65BC; <code>take(channel)</code>&#xFF0C;&#x4F46;&#x662F;&#x7576;&#x63A5;&#x6536;&#x5230;&#x4E00;&#x500B; <code>END</code> action &#x4E0D;&#x6703;&#x81EA;&#x52D5;&#x7684;&#x7D42;&#x6B62; &#x76F8;&#x53CD;&#x7684;&#xFF0C;&#x7576; take &#x7684; Effect &#x5F97;&#x5230; <code>END</code> &#x7269;&#x4EF6;&#xFF0C;&#x6240;&#x6709; Saga &#x90FD;&#x6703;&#x88AB; block&#x3002;<a href="#takemaybepattern">&#x4E86;&#x89E3;&#x66F4;&#x591A;</a></p><h3 id="putaction"><code>put(action)</code></h3><p>&#x5EFA;&#x7ACB;&#x4E00;&#x500B; Effect &#x63CF;&#x8FF0;&#x4F86;&#x8AAA;&#x660E; middleware &#x53BB; dispatch &#x4E00;&#x500B; action &#x5230; Store&#x3002;
&#x9019;&#x500B; effect &#x662F;&#x975E;&#x963B;&#x585E;&#x7684;&#xFF0C;&#x4EFB;&#x4F55;&#x932F;&#x8AA4;&#x90FD;&#x6703;&#x5411;&#x4E0B;&#x62CB;&#x51FA;&#xFF08;&#x4F8B;&#x5982;&#xFF1A;&#x5728;&#x4E00;&#x500B; reducer&#xFF09;&#x4E0D;&#x6703;&#x5192;&#x6CE1;&#x56DE;&#x5230; saga&#x3002;</p><ul><li><code>action: Object</code> - <a href="http://redux.js.org/docs/api/Store.html#dispatch" target="_blank">&#x5B8C;&#x6574;&#x8CC7;&#x8A0A;&#x8ACB;&#x53C3;&#x8003; Redux <code>dispatch</code> &#x6587;&#x4EF6;</a>
</li></ul>
<h3 id="putresolveaction"><code>put.resolve(action)</code></h3><p>&#x5C31;&#x50CF; <a href="#putaction"><code>put</code></a> &#x4E00;&#x6A23;&#xFF0C;&#x4F46;&#x662F; effect &#x662F;&#x963B;&#x585E;&#x7684;&#xFF08;&#x5982;&#x679C; promise &#x5F9E; <code>dispatch</code> &#x88AB;&#x56DE;&#x50B3;&#xFF0C;&#x5B83;&#x5C07;&#x7B49;&#x5F85; resolve&#xFF09;&#x4E26;&#x6703;&#x5F9E; downstream &#x5192;&#x6CE1;&#x932F;&#x8AA4;&#x3002;</p><ul><li><code>action: Object</code> - <a href="http://redux.js.org/docs/api/Store.html#dispatch" target="_blank">&#x5B8C;&#x6574;&#x8CC7;&#x8A0A;&#x8ACB;&#x53C3;&#x8003; Redux <code>dispatch</code> &#x6587;&#x4EF6;</a>
</li></ul>
<h3 id="putchannel-action"><code>put(channel, action)</code></h3><p>&#x5EFA;&#x7ACB;&#x4E00;&#x500B; Effect &#x63CF;&#x8FF0;&#xFF0C;&#x6307;&#x793A; middleware put &#x4E00;&#x500B; action &#x5230;&#x63D0;&#x4F9B;&#x7684; channel&#x3002;</p><ul><li><code>channel: Channel</code> - &#x4E00;&#x500B; <a href="#channel"><code>Channel</code></a> &#x7269;&#x4EF6;
</li>
<li><code>action: Object</code> - <a href="http://redux.js.org/docs/api/Store.html#dispatch" target="_blank">&#x5B8C;&#x6574;&#x8CC7;&#x8A0A;&#x8ACB;&#x53C3;&#x8003; Redux <code>dispatch</code> &#x6587;&#x4EF6;</a>
</li></ul>
<p>&#x5982;&#x679C; put &#x7684; effect <em>&#x4E0D;&#x662F;</em>&#x88AB;&#x7DE9;&#x885D;&#x7684;&#xFF0C;&#x800C;&#x662F;&#x7ACB;&#x5373;&#x88AB; takers consume&#xFF0C;&#x90A3;&#x9EBC;&#x5B83;&#x662F;&#x963B;&#x585E;&#x7684;&#x3002;&#x5982;&#x679C;&#x5728;&#x4EFB;&#x4F55; takers &#x62CB;&#x51FA;&#x4E00;&#x500B;&#x932F;&#x8AA4;&#xFF0C;&#x5B83;&#x5C07;&#x6703;&#x5192;&#x6CE1;&#x56DE;&#x5230; saga&#x3002;</p><h3 id="callfn-args"><code>call(fn, ...args)</code></h3><p>&#x5EFA;&#x7ACB;&#x4E00;&#x500B; Effect &#x63CF;&#x8FF0;&#xFF0C;&#x6307;&#x793A; middleware &#x547C;&#x53EB; function <code>fn</code> &#x548C; <code>args</code> &#x4F5C;&#x70BA;&#x53C3;&#x6578;&#x3002;</p><ul><li><code>fn: Function</code> - &#x4E00;&#x500B; Generator function&#xFF0C;&#x6216;&#x8005;&#x6B63;&#x5E38;&#x7684; function &#x56DE;&#x50B3;&#x4E00;&#x500B; Promise &#x505A;&#x70BA;&#x7D50;&#x679C;&#x3002;
</li>
<li><code>args: Array<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>any</span><span class="token punctuation">&gt;</span></span></code> - &#x4E00;&#x500B;&#x9663;&#x5217;&#x503C;&#x88AB;&#x4F5C;&#x70BA;&#x53C3;&#x6578;&#x50B3;&#x9001;&#x5230; <code>fn</code>
</li></ul>
<h4 id="&#x6CE8;&#x610F;">&#x6CE8;&#x610F;</h4><p><code>fn</code> &#x53EF;&#x4EE5;&#x662F;&#x4E00;&#x500B;<em>&#x6B63;&#x5E38;</em>&#x6216;&#x662F;&#x4E00;&#x500B; Generator function&#x3002;</p><p>middleware &#x8ABF;&#x7528; function &#x4E26;&#x6AA2;&#x67E5;&#x5B83;&#x7684;&#x7D50;&#x679C;&#x3002;</p><p>&#x5982;&#x679C;&#x7D50;&#x679C;&#x662F;&#x4E00;&#x500B; Generator &#x7269;&#x4EF6;&#xFF0C;middleware &#x57F7;&#x884C;&#x5B83;&#x5C31;&#x50CF;&#x555F;&#x52D5; Generator&#xFF08;&#x5728;&#x555F;&#x52D5;&#x6642;&#x88AB;&#x50B3;&#x9001;&#x5230; middleware&#xFF09;&#x4E00;&#x6A23;&#x3002;&#x7236; Generator &#x5C07;&#x66AB;&#x505C;&#x76F4;&#x5230;&#x5B50; Generator &#x6B63;&#x5E38;&#x7D50;&#x675F;&#xFF0C;&#x5728;&#x9019;&#x500B;&#x60C5;&#x6CC1;&#x7236; Generator &#x88AB;&#x6062;&#x5FA9;&#x4E26;&#x900F;&#x904E;&#x5B50; Generator &#x56DE;&#x50B3;&#x503C;&#x3002;&#x6216;&#x8005;&#xFF0C;&#x5B50; Generator &#x56E0;&#x70BA;&#x4E00;&#x4E9B;&#x932F;&#x8AA4;&#x800C;&#x7D42;&#x6B62;&#xFF0C;&#x5728;&#x9019;&#x500B;&#x60C5;&#x6CC1;&#x7236; Generator &#x6703;&#x5F9E;&#x5167;&#x90E8;&#x62CB;&#x51FA;&#x932F;&#x8AA4;&#x3002;</p><p>&#x5982;&#x679C;&#x7D50;&#x679C;&#x662F;&#x4E00;&#x500B; Promise&#xFF0C;middleware &#x5C07;&#x66AB;&#x505C; Generator &#x76F4;&#x5230; Promise &#x88AB; resolve&#xFF0C;&#x5728;&#x9019;&#x500B;&#x60C5;&#x6CC1;&#x6062;&#x5FA9; Generator &#x8207; resolve &#x5F8C;&#x7684;&#x503C;&#xFF0C;&#x6216;&#x8005;&#x76F4;&#x5230; Promise &#x88AB; reject&#xFF0C;&#x900F;&#x904E; Generator &#x5F9E;&#x5167;&#x90E8;&#x62CB;&#x51FA;&#x932F;&#x8AA4;&#x3002;</p><p>&#x5982;&#x679C;&#x7D50;&#x679C;&#x4E0D;&#x662F;&#x4E00;&#x500B; Iterator &#x7269;&#x4EF6;&#x6216;&#x662F; Promise&#xFF0C;middleware &#x5C07;&#x6703;&#x7ACB;&#x5373;&#x56DE;&#x50B3; value &#x7D66; saga&#xFF0C;
&#x6240;&#x4EE5;&#x5B83;&#x53EF;&#x4EE5;&#x540C;&#x6B65;&#x7684;&#x6062;&#x5FA9;&#x57F7;&#x884C;&#x3002;</p><p>&#x5982;&#x679C;&#x76EE;&#x524D;&#x7684; <code>yield</code> &#x6709;&#x4E00;&#x500B; <code>try/catch</code> &#x5340;&#x584A;&#xFF0C;&#x7576;&#x932F;&#x8AA4;&#x5F9E; Generator &#x5167;&#x90E8;&#x88AB;&#x62CB;&#x51FA;&#x4F86;&#x6642;&#xFF0C;&#x5C07;&#x6703;&#x88AB;&#x50B3;&#x9001;&#x5230; <code>catch</code> &#x5340;&#x584A;&#x3002;&#x9664;&#x6B64;&#x4E4B;&#x5916;&#xFF0C;Generator &#x96A8;&#x8457;&#x767C;&#x51FA;&#x7684;&#x932F;&#x8AA4;&#x7D42;&#x6B62;&#xFF0C;&#x5982;&#x679C;&#x76EE;&#x524D;&#x7684; Generator &#x88AB;&#x5176;&#x4ED6; Generator &#x547C;&#x53EB;&#xFF0C;&#x932F;&#x8AA4;&#x5C07;&#x6703;&#x50B3;&#x64AD;&#x5230;&#x547C;&#x53EB;&#x7684; Generator&#x3002;</p><h3 id="callcontext-fn-args"><code>call([context, fn], ...args)</code></h3><p>&#x8207; <code>call(fn, ...args)</code> &#x4E00;&#x6A23;&#xFF0C;&#x4F46;&#x662F;&#x652F;&#x63F4;&#x50B3;&#x9001; <code>this</code> context &#x5230; <code>fn</code>&#xFF0C;&#x9019;&#x5728;&#x8ABF;&#x7528;&#x7269;&#x4EF6;&#x65B9;&#x6CD5;&#x5F88;&#x6709;&#x7528;&#x3002;</p><h3 id="callcontext-fnname-args"><code>call([context, fnName], ...args)</code></h3><p>&#x76F8;&#x540C;&#x65BC; <code>call([context, fn], ...args)</code>&#xFF0C;&#x4F46;&#x662F;&#x652F;&#x63F4;&#x50B3;&#x9001;&#x4E00;&#x500B; <code>fn</code> &#x4F5C;&#x70BA; string&#x3002;&#x5C0D;&#x65BC;&#x8ABF;&#x7528;&#x7269;&#x4EF6;&#x7684;&#x65B9;&#x6CD5;&#x5F88;&#x6709;&#x7528;&#xFF0C;&#x4E5F;&#x5C31;&#x662F; <code>yield call([localStorage, &apos;getItem&apos;], &apos;redux-saga&apos;)</code></p><h3 id="applycontext-fn-args"><code>apply(context, fn, [args])</code></h3><p><code>call([context, fn], ...args)</code> &#x7684;&#x5225;&#x540D;&#xFF08;Alias&#xFF09;&#x3002;</p><h3 id="cpsfn-args"><code>cps(fn, ...args)</code></h3><p>&#x5EFA;&#x7ACB;&#x4E00;&#x500B; Effect &#x63CF;&#x8FF0;&#xFF0C;&#x6307;&#x793A; middleware &#x53BB;&#x8ABF;&#x7528; Node &#x98A8;&#x683C;&#x7684; <code>fn</code> function&#x3002;</p><ul><li><p><code>fn: Function</code> - &#x4E00;&#x500B; Node &#x98A8;&#x683C; function&#x3002;&#x4F8B;&#x5982;&#xFF1A;&#x4E00;&#x500B; function &#x9664;&#x4E86;&#x672C;&#x8EAB;&#x7684;&#x53C3;&#x6578;&#xFF0C;&#x5728; <code>fn</code> &#x7D50;&#x675F;&#x6642;&#x8ABF;&#x7528; callback&#x3002;callback &#x63A5;&#x53D7;&#x5169;&#x500B;&#x53C3;&#x6578;&#xFF0C;&#x7B2C;&#x4E00;&#x500B;&#x53C3;&#x6578;&#x88AB;&#x7528;&#x4F86;&#x5831;&#x544A;&#x932F;&#x8AA4;&#xFF0C;&#x7B2C;&#x4E8C;&#x500B;&#x662F;&#x88AB;&#x7528;&#x4F86;&#x5831;&#x544A;&#x6210;&#x529F;&#x7684;&#x7D50;&#x679C;&#x3002;</p></li>
<li><p><code>args: Array<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>any</span><span class="token punctuation">&gt;</span></span></code> - &#x4E00;&#x500B;&#x9663;&#x5217;&#x505A;&#x70BA;&#x53C3;&#x6578;&#x50B3;&#x7D66; <code>fn</code></p></li></ul>
<h4 id="&#x6CE8;&#x610F;">&#x6CE8;&#x610F;</h4><p>middleware &#x5C07;&#x57F7;&#x884C;&#x547C;&#x53EB; <code>fn(...arg, cb)</code>&#x3002;<code>cb</code> &#x900F;&#x904E; middleware &#x50B3;&#x9001;&#x7D66; <code>fn</code>&#x3002;&#x5982;&#x679C; <code>fn</code> &#x6B63;&#x5E38;&#x7D50;&#x675F;&#x6642;&#xFF0C;&#x5B83;&#x5FC5;&#x9808;&#x547C;&#x53EB; <code>cb(null, result)</code> &#x4F86;&#x901A;&#x77E5; middleware &#x6210;&#x529F;&#x4E86;&#xFF0C;&#x5982;&#x679C; <code>fn</code> &#x9047;&#x5230;&#x4E00;&#x4E9B;&#x932F;&#x8AA4;&#xFF0C;&#x5B83;&#x5FC5;&#x9808;&#x547C;&#x53EB; <code>cb(error)</code>&#xFF0C;&#x70BA;&#x4E86;&#x901A;&#x77E5; middleware &#x6709;&#x932F;&#x8AA4;&#x767C;&#x751F;&#x3002;</p><p>middleware &#x4ECD;&#x7136;&#x6703;&#x66AB;&#x505C;&#xFF0C;&#x76F4;&#x5230; <code>fn</code> &#x7D42;&#x6B62;&#x3002;</p><h3 id="cpscontext-fn-args"><code>cps([context, fn], ...args)</code></h3><p>&#x652F;&#x63F4;&#x50B3;&#x9001;&#x4E00;&#x500B; <code>this</code> context &#x5230; <code>fn</code>&#xFF08;&#x8ABF;&#x7528;&#x7269;&#x4EF6;&#x65B9;&#x6CD5;&#xFF09;&#x3002;</p><h3 id="forkfn-args"><code>fork(fn, ...args)</code></h3><p>&#x5EFA;&#x7ACB;&#x4E00;&#x500B; Effect &#x63CF;&#x8FF0;&#xFF0C;&#x6307;&#x793A; middleware &#x5728; <code>fn</code> &#x57F7;&#x884C;&#x4E00;&#x500B;<em>&#x975E;&#x963B;&#x585E;&#x547C;&#x53EB;</em>&#x3002;</p><h4 id="&#x53C3;&#x6578;">&#x53C3;&#x6578;</h4><ul><li><p><code>fn: Function</code> - &#x4E00;&#x500B; Generator function&#xFF0C;&#x6216;&#x8005;&#x6B63;&#x5E38;&#x7684; function &#x56DE;&#x50B3;&#x4E00;&#x500B; Promise &#x505A;&#x70BA;&#x7D50;&#x679C;</p></li>
<li><p><code>args: Array<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>any</span><span class="token punctuation">&gt;</span></span></code> - &#x4E00;&#x500B;&#x9663;&#x5217;&#x503C;&#x88AB;&#x4F5C;&#x70BA;&#x53C3;&#x6578;&#x50B3;&#x9001;&#x5230; <code>fn</code></p></li></ul>
<p>&#x56DE;&#x50B3;&#x4E00;&#x500B; <a href="#task">Task</a> object&#x3002;</p><h4 id="&#x6CE8;&#x610F;">&#x6CE8;&#x610F;</h4><p><code>fork</code> &#x985E;&#x4F3C;&#x65BC; <code>call</code>&#xFF0C;&#x53EF;&#x4EE5;&#x88AB;&#x7528;&#x4F86;&#x8ABF;&#x7528;&#x666E;&#x901A; function &#x548C; Generator function&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x547C;&#x53EB;&#x662F;&#x975E;&#x963B;&#x585E;&#x7684;&#xFF0C;middleware &#x4E0D;&#x6703;&#x5728; <code>fn</code> &#x7B49;&#x5F85;&#x7D50;&#x679C;&#x800C;&#x66AB;&#x505C; Generator&#x3002;&#x76F8;&#x53CD;&#x7684;&#x6703;&#x8ABF;&#x7528; <code>fn</code>&#xFF0C;&#x7ACB;&#x5373;&#x6062;&#x5FA9; Generator&#x3002;</p><p><code>fork</code> &#x548C; <code>race</code> &#x662F;&#x4E00;&#x500B;&#x4E2D;&#x5FC3;&#x5316;&#x7684; Effect&#xFF0C;&#x7BA1;&#x7406; Saga &#x4E4B;&#x9593;&#x7684;&#x4F75;&#x767C;&#x3002;</p><p><code>yield fork(fn ...args)</code> &#x7684;&#x7D50;&#x679C;&#x662F;&#x4E00;&#x500B; <a href="#task">Task</a> &#x7269;&#x4EF6;&#x3002;&#x4E00;&#x500B;&#x7269;&#x4EF6;&#x6709;&#x4E00;&#x4E9B;&#x6709;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#x548C;&#x5C6C;&#x6027;&#x3002;</p><p>&#x6240;&#x6709;&#x88AB; fork &#x7684; task &#x6703;&#x88AB;<em>&#x9644;&#x52A0;</em>&#x5230;&#x5B83;&#x5011;&#x7684; parents&#x3002;&#x7576; parent &#x7D42;&#x6B62;&#x5B83;&#x672C;&#x8EAB;&#x7684;&#x57F7;&#x884C;&#x6642;&#xFF0C;&#x5B83;&#x5C07;&#x7B49;&#x5F85;&#x6240;&#x6709;&#x88AB; fork &#x7684; task &#x518D;&#x56DE;&#x50B3;&#x524D;&#x7D42;&#x6B62;&#x3002;</p><p>&#x5F9E; child task &#x767C;&#x751F;&#x7684;&#x932F;&#x8AA4;&#x5C07;&#x6703;&#x81EA;&#x52D5;&#x5F97;&#x5192;&#x6CE1;&#x5230;&#x5B83;&#x5011;&#x7684; parent&#x3002;&#x5982;&#x679C;&#x4EFB;&#x4F55;&#x88AB; fork &#x7684; task &#x5F15;&#x767C;&#x4E86;&#x4E00;&#x500B;&#x672A;&#x6355;&#x7372;&#x7684;&#x932F;&#x8AA4;&#xFF0C;paraent task &#x5C07;&#x7D42;&#x6B62; child &#x8207;&#x932F;&#x8AA4;&#xFF0C;&#x4E26;&#x4E14;&#x6574;&#x500B; Parent &#x57F7;&#x884C; tree&#xFF08;&#x610F;&#x601D;&#x662F;&#xFF0C;&#x88AB; fork &#x7684; task &#x4EE5;&#x53CA;&#x5982;&#x679C; parent &#x672C;&#x8EAB;<em>&#x4E3B;&#x8981; task</em>&#x5B83;&#x4ECD;&#x7136;&#x5728;&#x57F7;&#x884C;&#xFF09;&#x5C07;&#x6703;&#x88AB;&#x53D6;&#x6D88;&#x3002;</p><p>&#x53D6;&#x6D88; fork &#x7684; Task &#x5C07;&#x6703;&#x81EA;&#x52D5;&#x53D6;&#x6D88;&#x6240;&#x6709;&#x88AB; fork &#x4E14;&#x4ECD;&#x7136;&#x5728;&#x57F7;&#x884C;&#x7684; task&#x3002;&#x5982;&#x679C;&#x53D6;&#x6D88;&#x7684; task &#x88AB;&#x963B;&#x585E;&#x7684;&#x8A71;&#xFF0C;&#x5B83;&#x4E5F;&#x6703;&#x53D6;&#x6D88;&#x76EE;&#x524D;&#x7684; Efffect&#x3002;</p><p>&#x5982;&#x679C;&#x4E00;&#x500B;&#x88AB; fork task <em>&#x540C;&#x6B65;</em>&#x5931;&#x6557;&#xFF08;&#x610F;&#x601D;&#x662F;&#xFF0C;&#x5728;&#x57F7;&#x884C;&#x4EFB;&#x4F55;&#x975E;&#x540C;&#x6B65;&#x64CD;&#x4F5C;&#x4E4B;&#x524D;&#xFF0C;&#x57F7;&#x884C;&#x5F8C;&#x7ACB;&#x5373;&#x5931;&#x6557;&#xFF09;&#xFF0C;&#x4E0D;&#x6703;&#x6709; Task &#x88AB;&#x56DE;&#x50B3;&#xFF0C;&#x76F8;&#x53CD;&#x7684;&#xFF0C;parent &#x5C07;&#x6703;&#x7ACB;&#x5373;&#x7684;&#x7D42;&#x6B62;&#xFF08;&#x7531;&#x65BC; parent &#x548C; child &#x5169;&#x8005;&#x5E73;&#x884C;&#x57F7;&#x884C;&#xFF0C; parent &#x6CE8;&#x610F;&#x5230; child &#x7684;&#x5931;&#x6557;&#x5C07;&#x6703;&#x7ACB;&#x5373;&#x7D42;&#x6B62;&#xFF09;&#x3002;</p><p>&#x5982;&#x679C;&#x8981;&#x5EFA;&#x7ACB;<em>&#x5206;&#x96E2;</em>&#x7684; fork&#xFF0C;&#x4F7F;&#x7528; <code>spawn</code>&#x3002;</p><h3 id="forkcontext-fn-args"><code>fork([context, fn], ...args)</code></h3><p>&#x652F;&#x63F4;&#x88AB;&#x8ABF;&#x7528;&#x6709; <code>this</code> context &#x7684; fork function&#x3002;</p><h3 id="spawnfn-args"><code>spawn(fn, ...args)</code></h3><p>&#x8207; <code>fork(fn, ...args)</code> &#x4E00;&#x6A23;&#xFF0C;&#x4F46;&#x662F;&#x5EFA;&#x7ACB;&#x4E00;&#x500B;<em>&#x5206;&#x96E2;</em>&#x7684; task&#x3002;&#x5206;&#x96E2;&#x7684; task &#x662F;&#x7368;&#x7ACB;&#x65BC;&#x7236; task&#xFF0C;&#x800C;&#x4E14;&#x884C;&#x70BA;&#x50CF;&#x662F;&#x4E00;&#x500B;&#x9AD8;&#x968E;&#x7684; task&#x3002;&#x7236; task &#x56DE;&#x50B3;&#x6642;&#x5C07;&#x4E0D;&#x6703;&#x7B49;&#x5F85;&#x5206;&#x96E2;&#x7684; task &#x7D42;&#x6B62;&#xFF0C;&#x800C;&#x4E14;&#x6240;&#x6709;&#x4E8B;&#x4EF6;&#x53EF;&#x80FD;&#x5F71;&#x97FF;&#x7236; task &#x6216;&#x662F;&#x5B8C;&#x5168;&#x5206;&#x96E2;&#x7368;&#x7ACB;&#x7684; task&#xFF08;&#x932F;&#x8AA4;&#x3001;&#x53D6;&#x6D88;&#xFF09;&#x3002;</p><h3 id="spawncontext-fn-args"><code>spawn([context, fn], ...args)</code></h3><p>&#x652F;&#x63F4;&#x88AB;&#x8ABF;&#x7528;&#x6709; <code>this</code> context &#x7684; spawn function&#x3002;</p><h3 id="jointask"><code>join(task)</code></h3><p>&#x5EFA;&#x7ACB;&#x4E00;&#x500B; Effect &#x63CF;&#x8FF0;&#xFF0C;&#x6307;&#x793A; middleware &#x7B49;&#x5F85;&#x5148;&#x524D;&#x88AB; fork task &#x7684;&#x7D50;&#x679C;&#x3002;</p><ul><li><code>task: Task</code> - &#x900F;&#x904E;&#x5148;&#x524D; <code>fork</code> &#x56DE;&#x50B3;&#x4E00;&#x500B; <a href="#task">Task</a> &#x7269;&#x4EF6;
</li></ul>
<h4 id="&#x6CE8;&#x610F;">&#x6CE8;&#x610F;</h4><p><code>join</code>  &#x5C07;&#x89E3;&#x6790;&#x76F8;&#x540C;&#x88AB;&#x52A0;&#x5165; task &#x7684;&#x7D50;&#x679C;&#xFF08;&#x6210;&#x529F;&#x6216;&#x5931;&#x6557;&#xFF09;&#x3002;&#x5982;&#x679C;&#x88AB;&#x52A0;&#x5165;&#x7684; task &#x88AB;&#x53D6;&#x6D88;&#xFF0C;&#x53D6;&#x6D88;&#x4E5F;&#x6703;&#x50B3;&#x64AD;&#x5230; join effect &#x57F7;&#x884C;&#x7684; Saga&#x3002;&#x540C;&#x6A23;&#x7684;&#xFF0C;&#x4EFB;&#x4F55;&#x90A3;&#x4E9B; joiner &#x6F5B;&#x5728;&#x7684; caller &#x5C07;&#x88AB;&#x53D6;&#x6D88;&#x3002;</p><h3 id="jointasks"><code>join(...tasks)</code></h3><p>&#x5EFA;&#x7ACB;&#x4E00;&#x500B; Effect &#x63CF;&#x8FF0;&#xFF0C;&#x6307;&#x793A; middleware &#x7B49;&#x5F85;&#x5148;&#x524D;&#x88AB; fork task &#x7684;&#x7D50;&#x679C;&#x3002;</p><ul><li><code>tasks: Array<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Task</span><span class="token punctuation">&gt;</span></span></code> - &#x900F;&#x904E;&#x5148;&#x524D; <code>fork</code> &#x56DE;&#x50B3;&#x4E00;&#x500B; <a href="#task">Task</a> &#x7269;&#x4EF6;
</li></ul>
<h4 id="&#x6CE8;&#x610F;">&#x6CE8;&#x610F;</h4><p>&#x5B83;&#x53EA;&#x662F;&#x5728; <a href="#jointask">join effects</a> wrap task &#x7684;&#x9663;&#x5217;&#xFF0C;&#x5927;&#x81F4;&#x76F8;&#x7B49;&#x65BC; <code>yield tasks.map(t =&gt; join(t))</code>&#x3002;</p><h3 id="canceltask"><code>cancel(task)</code></h3><p>&#x5EFA;&#x7ACB;&#x4E00;&#x500B; Effect &#x63CF;&#x8FF0;&#xFF0C;&#x6307;&#x793A; middleware &#x53D6;&#x6D88;&#x5148;&#x524D;&#x88AB; fork &#x7684; task&#x3002;</p><ul><li><code>task: Task</code> - &#x900F;&#x904E;&#x5148;&#x524D; <code>fork</code> &#x56DE;&#x50B3;&#x4E00;&#x500B; <a href="#task">Task</a> &#x7269;&#x4EF6;
</li></ul>
<h4 id="&#x6CE8;&#x610F;">&#x6CE8;&#x610F;</h4><p>&#x70BA;&#x4E86;&#x53D6;&#x6D88;&#x57F7;&#x884C;&#x7684; task&#xFF0C;middleware &#x5C07;&#x5728;&#x5E95;&#x5C64;&#x7684; Generator &#x7269;&#x4EF6;&#x8ABF;&#x7528; <code>return</code>&#xFF0C;&#x5B83;&#x5C07;&#x53D6;&#x6D88;&#x76EE;&#x524D;&#x5728; task &#x7684; Effect &#x4E26;&#x8DF3;&#x5230; finally &#x5340;&#x584A;&#xFF08;&#x5982;&#x679C;&#x6709;&#x5B9A;&#x7FA9;&#xFF09;&#x3002;</p><p>&#x5728;&#x5167;&#x90E8;&#x7684; finally &#x5340;&#x584A;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x57F7;&#x884C;&#x4EFB;&#x4F55;&#x6E05;&#x7406;&#x908F;&#x8F2F;&#x6216; dispatch &#x4E00;&#x4E9B; action &#x4F86;&#x4FDD;&#x6301; store &#x7684; state &#x4E00;&#x81F4;&#xFF08;&#x4E5F;&#x5C31;&#x662F;&#x8AAA;&#xFF0C;&#x7576; ajax &#x8ACB;&#x6C42;&#x88AB;&#x53D6;&#x6D88;&#x6642;&#xFF0C;&#x91CD;&#x7F6E; spinner &#x7684; state&#xFF09;&#x3002;&#x5982;&#x679C;&#x767C;&#x51FA;&#x4E00;&#x500B; <code>yield cancelled()</code> &#x53D6;&#x6D88; Saga&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x78BA;&#x8A8D;&#x5167;&#x90E8;&#x7684; finally &#x5340;&#x584A;&#x3002;</p><p>&#x53D6;&#x6D88;&#x5F80;&#x4E0B;&#x50B3;&#x64AD;&#x5230;&#x5B50; saga&#x3002;&#x7576;&#x53D6;&#x6D88;&#x4E00;&#x500B; task&#xFF0C;middleware &#x4E5F;&#x53D6;&#x6D88;&#x76EE;&#x524D;&#x7684; Effect&#xFF08;task &#x76EE;&#x524D;&#x88AB;&#x963B;&#x585E;&#xFF09;&#x3002;&#x5982;&#x679C;&#x76EE;&#x524D; Effect &#x547C;&#x53EB;&#x5176;&#x4ED6; Saga&#xFF0C;&#x5B83;&#x4E5F;&#x5C07;&#x88AB;&#x53D6;&#x6D88;&#x3002;&#x7576;&#x53D6;&#x6D88;&#x4E00;&#x500B; Saga &#x6642;&#xFF0C;&#x6240;&#x6709;<em>&#x88AB;&#x9644;&#x52A0;&#x7684; fork</em>&#xFF08;sagas &#x4F7F;&#x7528; <code>yield fork()</code> fork&#xFF09;&#x5C07;&#x88AB;&#x53D6;&#x6D88;&#x3002;&#x9019;&#x610F;&#x601D;&#x53D6;&#x6D88; task &#x5C07;&#x5F71;&#x97FF;&#x6574;&#x500B;&#x57F7;&#x884C; &#x7684; tree&#x3002;</p><p><code>cancel</code> &#x662F;&#x4E00;&#x500B;&#x975E;&#x963B;&#x585E;&#x7684; Effect&#x3002;&#x4F8B;&#x5982;&#xFF1A;Saga &#x57F7;&#x884C;&#x53D6;&#x6D88;&#x5F8C;&#xFF0C;&#x5C07;&#x7ACB;&#x5373;&#x6062;&#x5FA9;&#x3002;</p><p>&#x5C0D;&#x65BC; function &#x56DE;&#x50B3; Promise &#x7D50;&#x679C;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x900F;&#x904E;&#x9644;&#x52A0; <code>[CANCEL]</code> &#x5230; Promise &#x52A0;&#x5165;&#x4F60;&#x7684;&#x53D6;&#x6D88;&#x908F;&#x8F2F;&#x3002;</p><p>&#x4EE5;&#x4E0B;&#x7BC4;&#x4F8B;&#x986F;&#x793A;&#x5982;&#x4F55;&#x9644;&#x52A0;&#x53D6;&#x6D88;&#x908F;&#x8F2F;&#x5230; Promise &#x7D50;&#x679C;&#xFF1A;</p><pre><code class="lang-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> CANCEL <span class="token punctuation">}</span> from <span class="token string">&apos;redux-saga&apos;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> fork<span class="token punctuation">,</span> cancel <span class="token punctuation">}</span> from <span class="token string">&apos;redux-saga/effects&apos;</span>

<span class="token keyword">function</span> <span class="token function">myApi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token function">myXhr</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>

  promise<span class="token punctuation">[</span>CANCEL<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> myXhr<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> promise
<span class="token punctuation">}</span>

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">mySaga</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">const</span> task <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">fork</span><span class="token punctuation">(</span>myApi<span class="token punctuation">)</span>

  <span class="token comment" spellcheck="true">// ... &#x4E4B;&#x5F8C;</span>
  <span class="token comment" spellcheck="true">// &#x5728; myAPI &#x7684;&#x7D50;&#x679C;&#x5C07;&#x547C;&#x53EB; promise[CANCEL]</span>
  <span class="token keyword">yield</span> <span class="token function">cancel</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<p>redux-saga &#x4F7F;&#x7528; <code>abort</code> &#x65B9;&#x6CD5;&#x5C07;&#x81EA;&#x52D5;&#x53D6;&#x6D88; jqXHR &#x7269;&#x4EF6;&#x3002;</p><h3 id="canceltasks"><code>cancel(...tasks)</code></h3><p>&#x5EFA;&#x7ACB;&#x4E00;&#x500B; Effect &#x63CF;&#x8FF0;&#x4F86;&#x6307;&#x793A; middleware &#x53D6;&#x6D88;&#x5148;&#x524D;&#x88AB; fork &#x7684; task&#x3002;</p><ul><li><code>tasks: Array<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Task</span><span class="token punctuation">&gt;</span></span></code> - &#x900F;&#x904E;&#x5148;&#x524D; <code>fork</code> &#x56DE;&#x50B3;&#x4E00;&#x500B; <a href="#task">Task</a> &#x7269;&#x4EF6;
</li></ul>
<h4 id="&#x6CE8;&#x610F;">&#x6CE8;&#x610F;</h4><p>&#x5B83;&#x53EA;&#x662F;&#x5728; <a href="#canceltask">cancel effects</a> wrap task &#x9663;&#x5217;&#xFF0C;&#x5927;&#x81F4;&#x4E0A;&#x76F8;&#x7B49;&#x65BC; <code>yield tasks.map(t =&gt; cancel(t))</code>&#x3002;</p><h3 id="cancel"><code>cancel()</code></h3><p>&#x5EFA;&#x7ACB;&#x4E00;&#x500B; Effect &#x63CF;&#x8FF0;&#x6307;&#x793A; middleware &#x53BB;&#x53D6;&#x6D88;&#x4E00;&#x500B;&#x5DF2;&#x7D93;&#x88AB; yield &#x7684; task&#xFF08;&#x53D6;&#x6D88;&#x672C;&#x8EAB;&#xFF09;&#x3002;
&#x5C0D;&#x65BC;&#x5916;&#x90E8;&#xFF08;<code>cancel(task)</code>&#xFF09;&#x548C;&#x672C;&#x8EAB;&#xFF08;<code>cancel()</code>&#xFF09;&#xFF0C;&#x5B83;&#x5141;&#x8A31;&#x5728; <code>finally</code> &#x5340;&#x584A;&#x8907;&#x7528; destructor-like &#x908F;&#x8F2F;&#x3002;</p><h4 id="&#x7BC4;&#x4F8B;">&#x7BC4;&#x4F8B;</h4><pre><code class="lang-javascript"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">deleteRecord</span><span class="token punctuation">(</span><span class="token punctuation">{</span> payload <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> confirm<span class="token punctuation">,</span> deny <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">call</span><span class="token punctuation">(</span>prompt<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>confirm<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span>actions<span class="token punctuation">.</span>deleteRecord<span class="token punctuation">.</span><span class="token function">confirmed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>deny<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">yield</span> <span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// &#x8655;&#x7406;&#x932F;&#x8AA4;</span>
  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">yield</span> <span class="token function">cancelled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">// &#x88AB;&#x5171;&#x7528;&#x7684;&#x53D6;&#x6D88;&#x908F;&#x8F2F;</span>
      <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span>actions<span class="token punctuation">.</span>deleteRecord<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="selectselector-args"><code>select(selector, ...args)</code></h3><p>&#x5EFA;&#x7ACB;&#x4E00;&#x500B; Effect &#x63CF;&#x8FF0;&#xFF0C;&#x6307;&#x793A; middleware &#x5728;&#x76EE;&#x524D; Store &#x7684; state &#x8ABF;&#x7528;&#x63D0;&#x4F9B;&#x7684; selector&#xFF08;&#x4F8B;&#x5982;&#xFF1A;&#x56DE;&#x50B3; <code>selector(getState(), ...args)</code> &#x7684;&#x7D50;&#x679C;&#xFF09;&#x3002;</p><ul><li><p><code>selector: Function</code> - &#x4E00;&#x500B; <code>(state, ...args) =&gt; args</code> &#x7684; function&#x3002;&#x5B83; take &#x76EE;&#x524D; state &#x548C;&#x53EF;&#x9078;&#x7684;&#x53C3;&#x6578;&#x4E26;&#x56DE;&#x50B3;&#x4E00;&#x500B;&#x76EE;&#x524D; Store &#x7684; state &#x7684;&#x90E8;&#x4EFD;&#x3002;</p></li>
<li><p><code>args: Array<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>any</span><span class="token punctuation">&gt;</span></span></code> - &#x53EF;&#x9078;&#x7684;&#x53C3;&#x6578;&#x88AB;&#x50B3;&#x9001;&#x5230;&#x53E6;&#x5916;&#x7684; <code>getState</code> selector&#x3002;</p></li></ul>
<p>&#x5982;&#x679C; <code>select</code> &#x5982;&#x679C;&#x88AB;&#x547C;&#x53EB;&#x6642;&#x53C3;&#x6578;&#x70BA;&#x7A7A;&#xFF08;&#x4F8B;&#x5982;&#xFF1A;<code>yield select()</code>&#xFF09;&#xFF0C;effect &#x6703; resolve &#x6574;&#x500B; state&#xFF08;&#x8207;&#x547C;&#x53EB; <code>getState()</code> &#x76F8;&#x540C;&#xFF09;&#x3002;</p><blockquote><p>&#x6CE8;&#x610F;&#xFF0C;&#x7576;&#x4E00;&#x500B; action &#x88AB; dispatch &#x5230; store&#xFF0C;middleware &#x9996;&#x5148;&#x8F49;&#x767C; action &#x5230; reducer &#x4E26;&#x901A;&#x77E5; Saga&#xFF0C;&#x610F;&#x601D;&#x7576;&#x4F60;&#x67E5;&#x8A62; Store &#x7684; State &#x6642;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x5728; action &#x88AB;&#x8655;&#x7406;<strong>&#x4E4B;&#x5F8C;</strong>&#x53D6;&#x5F97; State&#x3002;
&#x7136;&#x800C;&#xFF0C;&#x9019;&#x500B;&#x884C;&#x70BA;&#x53EA;&#x4FDD;&#x8B49;&#x5982;&#x679C;&#x6240;&#x6709;&#x5F8C;&#x7E8C;&#x7684; middleware &#x540C;&#x6B65;&#x547C;&#x53EB; <code>next(action)</code>&#x3002;&#x5982;&#x679C;&#x4EFB;&#x4F55;&#x5F8C;&#x7E8C; middleware &#x975E;&#x540C;&#x6B65;&#x547C;&#x53EB; <code>next(action)</code>&#xFF08;&#x9019;&#x662F;&#x4E0D;&#x6B63;&#x5E38;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x53EF;&#x80FD;&#x767C;&#x751F;&#xFF09;&#xFF0C;Saga &#x5C07;&#x5F9E;<strong>&#x4E4B;&#x524D;</strong>&#x8655;&#x7406;&#x7684; action &#x53D6;&#x5F97; state&#x3002;&#x56E0;&#x6B64;&#x5EFA;&#x8B70;&#x6AA2;&#x67E5;&#x6BCF;&#x500B;&#x5F8C;&#x7E8C;&#x7684; middlewar &#x7684;&#x4F86;&#x6E90;&#xFF0C;&#x4EE5;&#x78BA;&#x4FDD;&#x5B83;&#x540C;&#x6B65;&#x547C;&#x53EB; <code>next(action)</code>&#xFF0C;&#x6216;&#x8005;&#x78BA;&#x4FDD;&#x8A72; redux-saga &#x662F;&#x547C;&#x53EB; chain &#x4E2D;&#x6700;&#x5F8C;&#x4E00;&#x500B; middleware&#x3002;</p></blockquote><p>&#x4F8B;&#x5982;&#xFF0C;&#x5047;&#x8A2D;&#x6211;&#x5011;&#x6709;&#x9019;&#x500B;&#x5F62;&#x72C0;&#x7684; state &#x5728;&#x6211;&#x5011;&#x7684;&#x61C9;&#x7528;&#x7A0B;&#x5F0F;&#xFF1A;</p><pre><code class="lang-javascript">state <span class="token operator">=</span> <span class="token punctuation">{</span>
  cart<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>&#x4F8B;&#x5982;&#xFF0C;&#x4E00;&#x500B; function &#x77E5;&#x9053;&#x5982;&#x4F55;&#x5F9E; State &#x63D0;&#x53D6; <code>cart</code> &#x8CC7;&#x6599;&#xFF1A;</p><p><code>./selectors</code></p><pre><code class="lang-javascript"><span class="token keyword">export</span> <span class="token keyword">const</span> getCart <span class="token operator">=</span> state <span class="token operator">=</span><span class="token operator">&gt;</span> state<span class="token punctuation">.</span>cart</code></pre>
<p>&#x7136;&#x5F8C;&#x6211;&#x5011;&#x5F9E;&#x5167;&#x90E8; Saga &#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>select</code> Effect &#x7684; selector&#xFF1A;</p><p><code>./sagas.js</code></p><pre><code class="lang-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> take<span class="token punctuation">,</span> fork<span class="token punctuation">,</span> select <span class="token punctuation">}</span> from <span class="token string">&apos;redux-saga/effects&apos;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> getCart <span class="token punctuation">}</span> from <span class="token string">&apos;./selectors&apos;</span>

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">checkout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// &#x4F7F;&#x7528;&#x88AB; export &#x7684; selector &#x67E5;&#x8A62; state</span>
  <span class="token keyword">const</span> cart <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">select</span><span class="token punctuation">(</span>getCart<span class="token punctuation">)</span>

  <span class="token comment" spellcheck="true">// ... &#x547C;&#x53EB;&#x4E00;&#x4E9B; API &#x7136;&#x5F8C; dispatch &#x4E00;&#x500B; success &#x6216; error &#x7684; action</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">rootSaga</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token keyword">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">yield</span> <span class="token function">take</span><span class="token punctuation">(</span><span class="token string">&apos;CHECKOUT_REQUEST&apos;</span><span class="token punctuation">)</span>
    <span class="token keyword">yield</span> <span class="token function">fork</span><span class="token punctuation">(</span>checkout<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p><code>checkout</code> &#x900F;&#x904E; <code>select(getCart)</code> &#x76F4;&#x63A5;&#x53D6;&#x5F97;&#x9700;&#x8981;&#x7684;&#x8CC7;&#x8A0A;&#xFF0C;Saga &#x53EA;&#x662F;&#x52A0;&#x4E0A; <code>getCart</code> selector&#x3002;&#x5982;&#x679C;&#x6211;&#x5011;&#x6709;&#x8A31;&#x591A; Saga&#xFF08;&#x6216; React Components&#xFF09;&#x9700;&#x8981;&#x53BB;&#x5B58;&#x53D6;&#x90E8;&#x4EFD;&#x7684; <code>cart</code>&#xFF0C;&#x4ED6;&#x5011;&#x6703;&#x8026;&#x5408;&#x5230;&#x76F8;&#x540C;&#x7684; <code>getCart</code> function&#x3002;&#x5982;&#x679C;&#x6211;&#x5011;&#x73FE;&#x5728;&#x6539;&#x8B8A; state &#x5F62;&#x72C0;&#xFF0C;&#x6211;&#x5011;&#x53EA;&#x9700;&#x8981;&#x66F4;&#x65B0; <code>getCart</code>&#x3002;</p><h3 id="actionchannelpattern-buffer"><code>actionChannel(pattern, [buffer])</code></h3><p>&#x5EFA;&#x7ACB;&#x4E00;&#x500B; Effect &#x63CF;&#x8FF0;&#xFF0C;&#x6307;&#x793A; middleware &#x4F7F;&#x7528;&#x7B26;&#x5408; <code>pattern</code> &#x7684; action &#x4E8B;&#x4EF6; channel &#x968A;&#x5217;&#x3002;&#x6216;&#x8005;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x63D0;&#x4F9B;&#x4E00;&#x500B;&#x7DE9;&#x885D;&#x53BB;&#x63A7;&#x5236;&#x88AB;&#x968A;&#x5217;&#x7684; action &#x7DE9;&#x885D;&#x3002;</p><ul><li><code>pattern:</code> - &#x53C3;&#x8003; <code>take(pattern)</code> API
</li>
<li><code>buffer: Buffer</code> - &#x4E00;&#x500B; <a href="#buffer">Buffer</a> &#x7269;&#x4EF6;
</li></ul>
<h4 id="&#x7BC4;&#x4F8B;">&#x7BC4;&#x4F8B;</h4><p>&#x4EE5;&#x4E0B;&#x7A0B;&#x5F0F;&#x78BC;&#x5EFA;&#x7ACB; channel &#x53BB;&#x7DE9;&#x885D;&#x6240;&#x6709; <code>USER_REQUEST</code> action&#x3002;&#x6CE8;&#x610F;&#xFF0C;&#x4E8B;&#x4EF6; Saga &#x6216;&#x8A31;&#x88AB;&#x963B;&#x585E;&#x5728; <code>call</code> effect&#x3002;&#x6240;&#x6709; action &#x5728;&#x963B;&#x585E;&#x7684;&#x540C;&#x6642;&#x81EA;&#x52D5;&#x88AB;&#x7DE9;&#x885D;&#xFF0C;&#x9019;&#x5C31;&#x662F; Saga &#x70BA;&#x4EC0;&#x9EBC;&#x53EF;&#x4EE5;&#x4E00;&#x6B21;&#x57F7;&#x884C;&#x4E00;&#x500B; API &#x547C;&#x53EB;&#x3002;</p><pre><code class="lang-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> actionChannel<span class="token punctuation">,</span> call <span class="token punctuation">}</span> from <span class="token string">&apos;redux-saga/effects&apos;</span>
<span class="token keyword">import</span> api from <span class="token string">&apos;...&apos;</span>

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">takeOneAtMost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> chan <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">actionChannel</span><span class="token punctuation">(</span><span class="token string">&apos;USER_REQUEST&apos;</span><span class="token punctuation">)</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token keyword">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>payload<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">take</span><span class="token punctuation">(</span>chan<span class="token punctuation">)</span>
    <span class="token keyword">yield</span> <span class="token function">call</span><span class="token punctuation">(</span>api<span class="token punctuation">.</span>getUser<span class="token punctuation">,</span> payload<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="flushchannel"><code>flush(channel)</code></h3><p>&#x5EFA;&#x7ACB;&#x4E00;&#x500B; Effect &#x6307;&#x793A; middleware &#x5F9E; channel &#x53BB; flush &#x6240;&#x6709;&#x88AB;&#x7DE9;&#x885D;&#x7684;&#x9805;&#x76EE;&#x3002;&#x88AB; flush &#x7684;&#x9805;&#x76EE;&#x88AB;&#x56DE;&#x50B3;&#x5230; saga&#xFF0C;&#x5982;&#x679C;&#x9700;&#x8981;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5B83;&#x5011;&#x3002;</p><ul><li><code>channel: Channel</code> - &#x4E00;&#x500B; <a href="#channel"><code>Channel</code></a> &#x7269;&#x4EF6;&#x3002;
</li></ul>
<h4 id="&#x7BC4;&#x4F8B;">&#x7BC4;&#x4F8B;</h4><pre><code class="lang-javascript">
<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">saga</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> chan <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">actionChannel</span><span class="token punctuation">(</span><span class="token string">&apos;ACTION&apos;</span><span class="token punctuation">)</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token keyword">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> action <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">take</span><span class="token punctuation">(</span>chan<span class="token punctuation">)</span>
      <span class="token comment" spellcheck="true">// ...</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> actions <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">flush</span><span class="token punctuation">(</span>chan<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">// ...</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span></code></pre>
<h3 id="cancelled"><code>cancelled()</code></h3><p>&#x5EFA;&#x7ACB;&#x4E00;&#x500B; Effect &#x63CF;&#x8FF0;&#xFF0C;&#x6307;&#x793A; middleware &#x53BB;&#x56DE;&#x50B3;&#x9019;&#x500B; generator &#x662F;&#x5426;&#x5DF2;&#x7D93;&#x88AB;&#x53D6;&#x6D88;&#x3002;&#x901A;&#x5E38;&#x4F60;&#x4F7F;&#x7528;&#x9019;&#x500B; Effect &#x5728; finally &#x5340;&#x584A;&#x57F7;&#x884C;&#x53D6;&#x6D88;&#x7279;&#x5B9A;&#x7684;&#x7A0B;&#x5F0F;&#x78BC;&#x3002;</p><h4 id="&#x7BC4;&#x4F8B;">&#x7BC4;&#x4F8B;</h4><pre><code class="lang-javascript">
<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">saga</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// ...</span>
  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">yield</span> <span class="token function">cancelled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">// &#x908F;&#x8F2F;&#x61C9;&#x8A72;&#x53EA;&#x57F7;&#x884C;&#x5728;&#x53D6;&#x6D88;</span>
    <span class="token punctuation">}</span>
    <span class="token comment" spellcheck="true">// &#x908F;&#x8F2F;&#x61C9;&#x8A72;&#x57F7;&#x884C;&#x5728;&#x6240;&#x6709;&#x60C5;&#x6CC1;&#xFF08;&#x4F8B;&#x5982;&#xFF1A;&#x95DC;&#x9589;&#x4E00;&#x500B; channel&#xFF09;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="setcontextprops"><code>setContext(props)</code></h3><p>&#x5EFA;&#x7ACB;&#x4E00;&#x500B; effect &#x6307;&#x793A; middleware &#x66F4;&#x65B0;&#x5B83;&#x672C;&#x8EAB;&#x7684; context&#x3002;&#x9019;&#x500B; effect &#x7E7C;&#x627F; saga &#x7684; context &#x800C;&#x4E0D;&#x662F;&#x66FF;&#x63DB;&#x5B83;&#x3002;</p><h3 id="getcontextprop"><code>getContext(prop)</code></h3><p>&#x5EFA;&#x7ACB;&#x4E00;&#x500B; effect &#x6307;&#x793A; middleware &#x56DE;&#x50B3; saga context &#x7279;&#x5B9A;&#x7684; property&#x3002;</p><h2 id="effect-combinators">Effect combinators</h2><h3 id="raceeffects"><code>race(effects)</code></h3><p>&#x5EFA;&#x7ACB;&#x4E00;&#x500B; Effect &#x63CF;&#x8FF0;&#x4F86;&#x6307;&#x793A; middleware &#x5728;&#x591A;&#x500B; Effect &#x4E4B;&#x9593;&#x53BB;&#x57F7;&#x884C;&#x4E00;&#x500B; <em>Race</em>&#xFF08;&#x9019;&#x6709;&#x9EDE;&#x985E;&#x4F3C;&#x65BC; <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Promise/race" target="_blank"><code>Promise.race([...])</code></a> &#x884C;&#x70BA;&#xFF09;&#x3002;</p><p><code>effects: Object</code> - &#x7269;&#x4EF6;&#x5F62;&#x5F0F; {label: effect, ...}</p><h4 id="&#x7BC4;&#x4F8B;">&#x7BC4;&#x4F8B;</h4><p>&#x4EE5;&#x4E0B;&#x7A0B;&#x5F0F;&#x78BC;&#x5728;&#x5169;&#x500B; effect &#x4E4B;&#x9593;&#x57F7;&#x884C; race&#xFF1A;</p><ol><li>&#x547C;&#x53EB; <code>feetchUsers</code> function &#x56DE;&#x50B3;&#x4E00;&#x500B; Promise
</li>
<li><code>CANCEL_FETCH</code> action &#x53EF;&#x80FD;&#x6700;&#x7D42;&#x5728; Store &#x88AB; dispatch
</li></ol>
<pre><code class="lang-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> take<span class="token punctuation">,</span> call<span class="token punctuation">,</span> race <span class="token punctuation">}</span> from `redux<span class="token operator">-</span>saga<span class="token operator">/</span>effects`
<span class="token keyword">import</span> fetchUsers from <span class="token string">&apos;./path/to/fetchUsers&apos;</span>

<span class="token keyword">function</span><span class="token operator">*</span> fetchUsersSaga <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> response<span class="token punctuation">,</span> cancel <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    response<span class="token punctuation">:</span> <span class="token function">call</span><span class="token punctuation">(</span>fetchUsers<span class="token punctuation">)</span><span class="token punctuation">,</span>
    cancel<span class="token punctuation">:</span> <span class="token function">take</span><span class="token punctuation">(</span>CANCEL_FETCH<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<p>&#x5982;&#x679C; <code>call(fetchUsers)</code> &#x9996;&#x5148; resolve&#xFF08;&#x6216; reject&#xFF09;&#xFF0C;<code>race</code> &#x7684;&#x7D50;&#x679C;&#x5C07;&#x662F;&#x4E00;&#x500B; <code>{response: result}</code> &#x7684;&#x7269;&#x4EF6;&#xFF0C;<code>result</code> &#x662F; <code>fetchUsers</code> &#x88AB; resolve &#x7684;&#x7D50;&#x679C;&#x3002;</p><p>&#x5982;&#x679C;&#x4E00;&#x500B; <code>CANCEL_FETCH</code> &#x985E;&#x578B;&#x7684; action &#x5728; <code>fetchUsers</code> &#x5B8C;&#x6210;&#x524D;&#x5728; Store &#x88AB; dispatch&#xFF0C;&#x7D50;&#x679C;&#x5C07;&#x6703;&#x662F;&#x4E00;&#x500B; <code>{cancel: action}</code>&#xFF0C;action &#x662F;&#x88AB; dispatch &#x7684; action&#x3002;</p><h4 id="&#x6CE8;&#x610F;">&#x6CE8;&#x610F;</h4><p>&#x7576; resolve <code>race</code> &#x6642;&#xFF0C;middleware &#x81EA;&#x52D5;&#x7684;&#x53D6;&#x6D88;&#x6240;&#x6709;&#x8F38;&#x6389;&#x7684; Effect&#x3002;</p><h3 id="raceeffects-with-array"><code>race([...effects]) (with Array)</code></h3><p>&#x76F8;&#x540C;&#x65BC; <a href="#raceeffects"><code>race(effects)</code></a>&#xFF0C;&#x4F46;&#x662F;&#x8B93;&#x4F60;&#x53EF;&#x4EE5;&#x50B3;&#x9001; Effect &#x7684;&#x9663;&#x5217;&#x3002;</p><h4 id="&#x7BC4;&#x4F8B;">&#x7BC4;&#x4F8B;</h4><p>&#x4EE5;&#x4E0B;&#x7BC4;&#x4F8B;&#x5728;&#x5169;&#x500B; Effect &#x4E4B;&#x9593;&#x57F7;&#x884C;&#x4E00;&#x500B;&#x7AF6;&#x722D;&#xFF1A;</p><ol><li>call &#x8ABF;&#x7528; <code>fetchUsers</code> &#x51FD;&#x5F0F;&#xFF0C;&#x56DE;&#x50B3;&#x4E00;&#x500B; Promsie call
</li>
<li>&#x4E00;&#x500B; <code>CANCEL_FETCH</code> action &#x6700;&#x5F8C;&#x53EF;&#x80FD; &#x5728; Store &#x88AB; dispatch
</li></ol>
<pre><code class="lang-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> take<span class="token punctuation">,</span> call<span class="token punctuation">,</span> race <span class="token punctuation">}</span> from `redux<span class="token operator">-</span>saga<span class="token operator">/</span>effects`
<span class="token keyword">import</span> fetchUsers from <span class="token string">&apos;./path/to/fetchUsers&apos;</span>

<span class="token keyword">function</span><span class="token operator">*</span> fetchUsersSaga <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>response<span class="token punctuation">,</span> cancel<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token function">call</span><span class="token punctuation">(</span>fetchUsers<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">take</span><span class="token punctuation">(</span>CANCEL_FETCH<span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<p>&#x5982;&#x679C; <code>call(fetchUsers)</code> &#x6700;&#x5148; resolve&#xFF08;&#x6216;&#x662F; rejects&#xFF09;&#xFF0C;<code>response</code> &#x5C07;&#x6703;&#x662F; <code>fetchUsers</code> &#x7684;&#x7D50;&#x679C;&#x800C;&#x4E14; <code>cancel</code> &#x5C07;&#x70BA; <code>undefined</code>&#x3002;</p><p>&#x5728; <code>fetchUsers</code> &#x5B8C;&#x6210;&#x4E4B;&#x524D;&#xFF0C;&#x5982;&#x679C;&#x4E00;&#x500B; type &#x70BA; <code>CANCEL_FETCH</code> &#x7684; action &#x5728; Store &#x88AB; dispatch &#xFF0C;<code>response</code> &#x5C07;&#x70BA; <code>undefined</code> &#x800C;&#x4E14; <code>cancel</code> &#x5C07;&#x6703; dispatch action&#x3002;</p><h3 id="raceeffects-with-array"><code>race([...effects]) (with Array)</code></h3><p>The same as <a href="#raceeffects"><code>race(effects)</code></a> but let you to pass in an array of effects.</p><h4 id="example">Example</h4><p>The following example runs a race between two effects:</p><ol><li>A call to a function <code>fetchUsers</code> which returns a Promise
</li>
<li>A <code>CANCEL_FETCH</code> action which may be eventually dispatched on the Store
</li></ol>
<pre><code class="lang-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> take<span class="token punctuation">,</span> call<span class="token punctuation">,</span> race <span class="token punctuation">}</span> from `redux<span class="token operator">-</span>saga<span class="token operator">/</span>effects`
<span class="token keyword">import</span> fetchUsers from <span class="token string">&apos;./path/to/fetchUsers&apos;</span>

<span class="token keyword">function</span><span class="token operator">*</span> fetchUsersSaga <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>response<span class="token punctuation">,</span> cancel<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token function">call</span><span class="token punctuation">(</span>fetchUsers<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">take</span><span class="token punctuation">(</span>CANCEL_FETCH<span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<p>If <code>call(fetchUsers)</code> resolves (or rejects) first, <code>response</code> will be an result of <code>fetchUsers</code> and <code>cancel</code> will be <code>undefined</code>.</p><p>If an action of type <code>CANCEL_FETCH</code> is dispatched on the Store before <code>fetchUsers</code> completes, <code>response</code> will be
<code>undefined</code> and <code>cancel</code> will be the dispatched action.</p><h3 id="alleffects---parallel-effects"><code>all([...effects]) - parallel effects</code></h3><p>&#x5EFA;&#x7ACB;&#x4E00;&#x500B; Effect &#x63CF;&#x8FF0;&#x4F86;&#x6307;&#x793A; middleware &#x5728;&#x5E73;&#x884C;&#x60C5;&#x6CC1;&#x4E0B;&#x57F7;&#x884C;&#x591A;&#x500B; Effect&#xFF0C;&#x4E26;&#x7B49;&#x5F85;&#x5B83;&#x5011;&#x5B8C;&#x6210;&#x3002;&#x5B83;&#x76F8;&#x7576;&#x65BC; <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Promise/all" target="_blank"><code>Promise#all</code></a> API &#x7684;&#x6A19;&#x6E96;&#x3002;</p><h4 id="&#x7BC4;&#x4F8B;">&#x7BC4;&#x4F8B;</h4><p>&#x4EE5;&#x4E0B;&#x7BC4;&#x4F8B;&#x540C;&#x6642;&#x57F7;&#x884C;&#x5169;&#x500B;&#x963B;&#x585E;&#x7684;&#x547C;&#x53EB;&#xFF1A;</p><pre><code class="lang-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> fetchCustomers<span class="token punctuation">,</span> fetchProducts <span class="token punctuation">}</span> from <span class="token string">&apos;./path/to/api&apos;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> all<span class="token punctuation">,</span> call <span class="token punctuation">}</span> from `redux<span class="token operator">-</span>saga<span class="token operator">/</span>effects`

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">mySaga</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>customers<span class="token punctuation">,</span> products<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token function">call</span><span class="token punctuation">(</span>fetchCustomers<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">call</span><span class="token punctuation">(</span>fetchProducts<span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="alleffects"><code>all(effects)</code></h3><p>&#x76F8;&#x540C;&#x65BC; <a href="#alleffects-parallel-effects"><code>all([...effects])</code></a>&#xFF0C;&#x4F46;&#x8B93;&#x4F60;&#x53EF;&#x4EE5;&#x5728; directionary &#x50B3;&#x9001;&#x5E36;&#x6709; label effects &#x7684;&#x7269;&#x4EF6;&#xFF0C;&#x5C31;&#x50CF; <a href="#alleffects"><code>race(effects)</code></a></p><ul><li><code>effects: Object</code> - &#x4E00;&#x500B; directionary {label: effect, ...} &#x5F62;&#x5F0F;&#x7684;&#x7269;&#x4EF6;
</li></ul>
<h4 id="&#x7BC4;&#x4F8B;">&#x7BC4;&#x4F8B;</h4><p>&#x4EE5;&#x4E0B;&#x7684;&#x7BC4;&#x4F8B;&#x4F75;&#x884C;&#x57F7;&#x884C;&#x5169;&#x500B; blocking &#x547C;&#x53EB;&#xFF1A;</p><pre><code class="lang-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> fetchCustomers<span class="token punctuation">,</span> fetchProducts <span class="token punctuation">}</span> from <span class="token string">&apos;./path/to/api&apos;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> all<span class="token punctuation">,</span> call <span class="token punctuation">}</span> from `redux<span class="token operator">-</span>saga<span class="token operator">/</span>effects`

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">mySaga</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> customers<span class="token punctuation">,</span> products <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    customers<span class="token punctuation">:</span> <span class="token function">call</span><span class="token punctuation">(</span>fetchCustomers<span class="token punctuation">)</span><span class="token punctuation">,</span>
    products<span class="token punctuation">:</span> <span class="token function">call</span><span class="token punctuation">(</span>fetchProducts<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<h4 id="&#x6CE8;&#x610F;">&#x6CE8;&#x610F;</h4><p>&#x7576;&#x540C;&#x6642;&#x57F7;&#x884C; Effect&#xFF0C;middleware &#x66AB;&#x505C; Generator &#x76F4;&#x5230;&#x4EE5;&#x4E0B;&#x5176;&#x4E2D;&#x4E00;&#x500B;&#x767C;&#x751F;&#xFF1A;</p><ul><li><p>&#x6240;&#x6709; Effect &#x6210;&#x529F;&#x7684;&#x88AB;&#x5B8C;&#x6210;&#xFF1A;&#x6062;&#x5FA9; Generator &#x8207;&#x4E00;&#x500B;&#x5305;&#x542B;&#x6240;&#x6709; Effect &#x7684;&#x9663;&#x5217;&#x7D50;&#x679C;&#x3002;</p></li>
<li><p>&#x5176;&#x4E2D;&#x4E00;&#x500B; Effect &#x5728;&#x6240;&#x6709; effect &#x5B8C;&#x6210;&#x4E4B;&#x524D;&#x88AB; reject&#xFF1A;&#x5728; Generator &#x5167;&#x62CB;&#x51FA; reject &#x932F;&#x8AA4;&#x3002;</p></li></ul>
<h2 id="interfaces">Interfaces</h2><h3 id="task">Task</h3><p>Task interface &#x6307;&#x5B9A;&#x4F7F;&#x7528; <code>fork</code>&#x3001;<code>middleware</code> &#x6216; <code>runSaga</code> &#x57F7;&#x884C; Saga &#x7684;&#x7D50;&#x679C;&#x3002;</p><table id="task-descriptor">
  <tr>
    <th>&#x65B9;&#x6CD5;</th>
    <th>&#x56DE;&#x50B3;&#x503C;</th>
  </tr>
  <tr>
    <td>task.isRunning()</td>
    <td>&#x5982;&#x679C; task &#x9084;&#x6C92;&#x56DE;&#x50B3;&#x6216;&#x62CB;&#x51FA;&#x4E00;&#x500B;&#x932F;&#x8AA4;&#x70BA; true &#x6642;</td>
  </tr>
  <tr>
    <td>task.isCancelled()</td>
    <td>&#x5982;&#x679C; task &#x5DF2;&#x7D93;&#x88AB;&#x53D6;&#x6D88;&#x70BA; true &#x6642;</td>
  </tr>
  <tr>
    <td>task.result()</td>
    <td>task &#x56DE;&#x50B3;&#x503C;&#x3002;&#x5982;&#x679C; task &#x4ECD;&#x7136;&#x5728;&#x57F7;&#x884C; `undefined`</td>
  </tr>
  <tr>
    <td>task.error()</td>
    <td>task &#x62CB;&#x51FA;&#x932F;&#x8AA4;&#x3002;&#x5982;&#x679C; task &#x4ECD;&#x7136;&#x5728;&#x57F7;&#x884C; `undefined`</td>
  </tr>
  <tr>
    <td>task.done</td>
    <td>
      Promise &#x7D50;&#x679C;&#x53EF;&#x80FD;&#x662F;&#xFF1A;
        <ul>
          <li>&#x88AB; resovle task &#x7684;&#x56DE;&#x50B3;&#x503C;</li>
          <li>&#x88AB; reject task &#x62CB;&#x51FA;&#x932F;&#x8AA4;</li>
        </ul>
      </td>
  </tr>
  <tr>
    <td>task.cancel()</td>
    <td>&#x53D6;&#x6D88; task&#xFF08;&#x5982;&#x679C; task &#x4ECD;&#x7136;&#x5728;&#x57F7;&#x884C;&#xFF09;</td>
  </tr>
</table>



<h3 id="channel">Channel</h3><p>&#x4E00;&#x500B; channel &#x7269;&#x4EF6;&#x662F;&#x88AB;&#x7528;&#x5728; task &#x4E4B;&#x9593;&#x50B3;&#x9001;&#x548C;&#x63A5;&#x6536;&#x8A0A;&#x606F;&#x3002;&#x4F86;&#x81EA; sender &#x7684;&#x8A0A;&#x606F;&#x88AB;&#x968A;&#x5217;&#x76F4;&#x5230;&#x4E00;&#x500B; receiver &#x8981;&#x6C42;&#x4E00;&#x500B;&#x8A0A;&#x606F;&#xFF0C;&#x88AB;&#x8A3B;&#x518A;&#x7684; receiver &#x88AB;&#x968A;&#x5217;&#x76F4;&#x5230;&#x6709;&#x4E00;&#x500B;&#x53EF;&#x7528;&#x8A0A;&#x606F;&#x3002;</p><p>&#x6BCF;&#x500B; channel &#x6709;&#x4E00;&#x500B;&#x5E95;&#x5C64;&#x7684; buffer&#xFF08;&#x7DE9;&#x885D;&#xFF09;&#xFF0C;&#x5B9A;&#x7FA9; buffer &#x7684;&#x7B56;&#x7565;&#xFF08;&#x4FEE;&#x6B63; size&#x3001;dropping&#x3001;sliding&#xFF09;&#x3002;</p><p>Channel interface &#x5B9A;&#x7FA9;&#x4E09;&#x500B;&#x65B9;&#x6CD5;&#xFF1A;<code>take</code>&#x3001;<code>put</code> &#x548C; <code>close</code></p><p><code>Channel.take(callback):</code> &#x88AB;&#x7528;&#x4F86;&#x8A3B;&#x518A;&#x4E00;&#x500B; taker&#x3002;take &#x662F;&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x898F;&#x5247;&#x88AB; resolve&#xFF1A;</p><ul><li>&#x5982;&#x679C; channel &#x6709;&#x88AB;&#x7DE9;&#x885D;&#x7684;&#x8A0A;&#x606F;&#xFF0C;<code>callback</code> &#x5C07;&#x5F9E;&#x5E95;&#x5C64; buffer &#x8ABF;&#x7528;&#x4E0B;&#x4E00;&#x500B;&#x8A0A;&#x606F;&#xFF08;&#x4F7F;&#x7528; <code>buffer.take()</code>&#xFF09;  
</li>
<li>&#x5982;&#x679C; channel &#x88AB;&#x95DC;&#x9589;&#xFF0C;&#x800C;&#x4E14;&#x6C92;&#x6709;&#x4EFB;&#x4F55;&#x7684;&#x8A0A;&#x606F;&#xFF0C;<code>callback</code> &#x8ABF;&#x7528; <code>END</code>
</li>
<li>&#x9664;&#x6B64;&#x4E4B;&#x5916;&#xFF0C;<code>callback</code> &#x5C07;&#x968A;&#x5217;&#x76F4;&#x5230;&#x4E00;&#x500B;&#x8A0A;&#x606F;&#x88AB; put &#x5230; channel
</li></ul>
<p><code>Channel.put(message):</code> &#x5728; buffer &#x4E0A; put &#x8A0A;&#x606F;&#x3002;put &#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x898F;&#x5247;&#x8655;&#x7406;&#xFF1A;</p><ul><li>&#x5982;&#x679C; channel &#x88AB;&#x95DC;&#x9589;&#xFF0C;put &#x4E0D;&#x6703;&#x6709; effect
</li>
<li>&#x5982;&#x679C;&#x662F;&#x7B49;&#x5F85;&#x7684; taker&#xFF0C;&#x8ABF;&#x7528;&#x820A;&#x7684; taker &#x8A0A;&#x606F;
</li>
<li>&#x9664;&#x6B64;&#x4E4B;&#x5916;&#xFF0C;&#x5728;&#x5E95;&#x5C64;&#x7DE9;&#x885D; put &#x8A0A;&#x606F;
</li></ul>
<p><code>Channel.flush(callback):</code> &#x4F7F;&#x7528;&#x5F9E; channel &#x63D0;&#x53D6;&#x6240;&#x6709;&#x88AB;&#x7DE9;&#x885D;&#x7684;&#x8A0A;&#x606F;&#x3002;&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x898F;&#x5247;&#x4F86; resolve flush</p><ul><li>&#x5982;&#x679C; channel &#x88AB;&#x95DC;&#x9589;&#xFF0C;&#x800C;&#x4E14;&#x6C92;&#x6709;&#x4EFB;&#x4F55;&#x88AB;&#x7DE9;&#x885D;&#x7684;&#x8A0A;&#x606F;&#xFF0C;<code>callback</code> &#x8207; <code>END</code> &#x88AB;&#x8ABF;&#x7528;
</li>
<li>&#x9664;&#x6B64;&#x4E4B;&#x5916;&#xFF0C;<code>callback</code> &#x8ABF;&#x7528;&#x6240;&#x6709;&#x88AB;&#x7DE9;&#x885D;&#x7684;&#x8A0A;&#x606F;
</li></ul>
<p><code>Channel.close():</code> &#x95DC;&#x9589; channel &#x610F;&#x601D;&#x662F;&#x4E0D;&#x518D;&#x5141;&#x8A31;&#x66F4;&#x591A;&#x7684; put&#x3002;&#x6240;&#x6709; pending &#x7684; taker &#x5C07;&#x6703;&#x8207; <code>END</code> &#x88AB;&#x8ABF;&#x7528;&#x3002;</p><h3 id="buffer">Buffer</h3><p>&#x5728; channel &#x5BE6;&#x73FE;&#x7DE9;&#x885D;&#xFF08;Buffer&#xFF09;&#x7B56;&#x7565;&#x3002;Buffer interface &#x5B9A;&#x7FA9;&#x4E09;&#x500B;&#x65B9;&#x6CD5;&#xFF1A; <code>isEmpty</code>&#x3001;<code>put</code> &#x548C; <code>take</code></p><ul><li><code>isEmpty()</code>: &#x5982;&#x679C;&#x7DE9;&#x885D;&#x6C92;&#x6709;&#x4EFB;&#x4F55;&#x8A0A;&#x606F;&#x70BA; true &#x6642;&#xFF0C;&#x6BCF;&#x7576;&#x4E00;&#x500B;&#x65B0;&#x7684; taker &#x88AB;&#x8A3B;&#x518A;&#x6642;&#xFF0C;channel &#x547C;&#x53EB;&#x9019;&#x500B;&#x65B9;&#x6CD5;
</li>
<li><code>put(message)</code>: &#x653E;&#x5165;&#x65B0;&#x7684;&#x8A0A;&#x606F;&#x5230; buffer&#x3002;&#x6CE8;&#x610F;&#xFF0C;Buffer &#x53EF;&#x4EE5;&#x9078;&#x64C7;&#x4E0D;&#x5132;&#x5B58;&#x8A0A;&#x606F;&#xFF08;&#x4F8B;&#x5982;&#xFF1A;&#x5982;&#x679C;&#x8D85;&#x904E;&#x7D66;&#x5B9A;&#x9650;&#x5236;&#x7684;&#x8A0A;&#x606F;&#xFF0C;&#x522A;&#x9664;&#x7DE9;&#x885D;&#x5340;&#x53EF;&#x4EE5;&#x4E1F;&#x68C4;&#x8A0A;&#x606F;&#xFF09;
</li>
<li><code>take()</code> &#x53D6;&#x5F97;&#x88AB;&#x7DE9;&#x885D;&#x7684;&#x8A0A;&#x606F;&#x3002;&#x6CE8;&#x610F;&#x6B64;&#x65B9;&#x6CD5;&#x7684;&#x884C;&#x70BA;&#x5FC5;&#x9808;&#x548C; <code>isEmpty</code> &#x4E00;&#x81F4;
</li></ul>
<h3 id="sagamonitor">SagaMonitor</h3><p>&#x7531; middleware &#x53BB; dispatch monitor &#x4E8B;&#x4EF6;&#x3002;&#x5BE6;&#x969B;&#x4E0A; middleware dispatch &#x4E94;&#x500B;&#x4E8B;&#x4EF6;&#xFF1A;</p><ul><li><p>&#x7576;&#x4E00;&#x500B; effect &#x88AB;&#x89F8;&#x767C;&#xFF08;&#x900F;&#x904E; <code>yield someEffect</code>&#xFF09;&#xFF0C;middleware &#x8ABF;&#x7528; <code>sagaMonitor.effectTriggered</code></p></li>
<li><p>&#x5982;&#x679C; effect &#x6210;&#x529F;&#x88AB; resolve&#xFF0C;middleware &#x8ABF;&#x7528; <code>sagaMonitor.effectResolved</code></p></li>
<li><p>&#x5982;&#x679C; effect &#x6709;&#x4E00;&#x500B;&#x932F;&#x8AA4;&#x88AB; reject&#xFF0C;middleware &#x8ABF;&#x7528; <code>sagaMonitor.effectRejected</code></p></li>
<li><p>&#x5982;&#x679C; effect &#x88AB;&#x53D6;&#x6D88;&#xFF0C;middleware &#x8ABF;&#x7528; <code>sagaMonitor.effectCancelled</code></p></li>
<li><p>&#x6700;&#x5F8C;&#xFF0C;&#x7576;&#x4E00;&#x500B; Redux action &#x88AB; dispatch&#xFF0C;middleware &#x8ABF;&#x7528; <code>sagaMonitor.actionDispatched</code></p></li></ul>
<p>&#x4EE5;&#x4E0B;&#x6BCF;&#x500B;&#x65B9;&#x6CD5;&#x7684;&#x7F72;&#x540D;&#xFF1A;</p><ul><li><p><code>effectTriggered(options)</code>&#xFF1A;&#x5177;&#x6709;&#x4EE5;&#x4E0B;&#x6B04;&#x4F4D;&#x7684;&#x7269;&#x4EF6;&#x9078;&#x9805;</p><ul><li><p><code>effectId</code> : Number - &#x7368;&#x7ACB;&#x7684; ID &#x88AB;&#x5206;&#x914D;&#x5230;&#x88AB; yield &#x7684; effect</p></li>
<li><p><code>parentEffectId</code> : Number - &#x5167;&#x90E8;&#x6240;&#x6709;&#x88AB; yield &#x7684; effect &#x5C07;&#x76F4;&#x63A5; <code>race</code> &#x6216; <code>parallel</code> effect&#x3002;&#x5728;&#x9AD8;&#x968E; effect &#x60C5;&#x6CC1;&#x4E0B;&#xFF0C;parent &#x5C07;&#x6703;&#x5305;&#x542B; Saga</p></li>
<li><p><code>label</code> : String - &#x5728; <code>race</code> effect &#x7684;&#x60C5;&#x6CC1;&#x4E0B;&#xFF0C;&#x6240;&#x6709;&#x5B50; effect &#x5C07;&#x88AB;&#x5206;&#x914D;&#x4F5C;&#x70BA; label &#x5C0D;&#x61C9;&#x7269;&#x4EF6;&#x7684; key &#x50B3;&#x9001;&#x5230; <code>race</code></p></li>
<li><p><code>effect</code> : Object - &#x88AB; yield effect &#x7684;&#x672C;&#x8EAB;</p></li></ul>
</li></ul>
<ul><li><p><code>effectResolved(effectId, result)</code></p><ul><li><p><code>effectId</code> : Number - &#x88AB; yield effect &#x7684; ID</p></li>
<li><p><code>result</code> : any - effect &#x6210;&#x529F;&#x89E3;&#x6C7A;&#x7684;&#x7D50;&#x679C;&#x3002;&#x5728; <code>fork</code> &#x6216;&#x662F; <code>spawn</code> effect &#x7684;&#x60C5;&#x6CC1;&#xFF0C;&#x7D50;&#x679C;&#x5C07;&#x6703;&#x662F;&#x4E00;&#x500B; <code>Task</code> &#x7269;&#x4EF6;&#x3002;</p></li></ul>
</li></ul>
<ul><li><p><code>effectRejected(effectId, error)</code></p><ul><li><p><code>effectId</code> : Number - &#x88AB; yield effect &#x7684; ID</p></li>
<li><p><code>error</code> : any - &#x5F15;&#x767C;&#x7684;&#x932F;&#x8AA4;&#x8207; effect &#x7684; reject</p></li></ul>
</li></ul>
<ul><li><p><code>effectCancelled(effectId)</code></p><ul><li><code>effectId</code> : Number - &#x88AB; yield effect &#x7684; ID
</li></ul>
</li>
<li><p><code>actionDispatched(action)</code></p><ul><li><code>action</code> : Object - &#x88AB; dispatch &#x7684; Redux action&#x3002;&#x5982;&#x679C;&#x900F;&#x904E;&#x4E00;&#x500B; Saga dispatch action&#xFF0C;action &#x5C07;&#x6703;&#x6709;&#x4E00;&#x500B; <code>SAGA_ACTION</code> &#x5C6C;&#x6027;&#x88AB;&#x8A2D;&#x5B9A;&#x70BA; true&#xFF08;&#x53EF;&#x4EE5;&#x5F9E; <code>redux-saga/utils</code> import <code>SAGA_ACTION</code>&#xFF09;
</li></ul>
</li></ul>
<h2 id="&#x5916;&#x90E8;-api">&#x5916;&#x90E8; API</h2><hr><h3 id="runsagaoptions-saga-args"><code>runSaga(options, saga, ...args)</code></h3><p>&#x5141;&#x8A31;&#x5728; Redux middleware &#x74B0;&#x5883;&#x5916;&#x555F;&#x52D5; saga&#x3002;&#x9664;&#x4E86; store action &#x5916;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x60F3;&#x8981;&#x9023;&#x7D50; Saga &#x5230;&#x5916;&#x90E8;&#x7684;&#x8F38;&#x5165;&#x6216;&#x8F38;&#x51FA;&#x9019;&#x662F;&#x975E;&#x5E38;&#x6709;&#x7528;&#x7684;&#x3002;</p><p><code>runSaga</code> &#x56DE;&#x50B3;&#x4E00;&#x500B; Task &#x7269;&#x4EF6;&#xFF0C;&#x5C31;&#x50CF;&#x5F9E; <code>fork</code> effect &#x56DE;&#x50B3;&#x4E00;&#x6A23;&#x3002;</p><ul><li><p><code>options: Object</code> - &#x76EE;&#x524D;&#x652F;&#x63F4;&#x7684;&#x9078;&#x9805;&#xFF1A;</p><ul><li><p><code>subscribe(callback): Function</code> - &#x63A5;&#x53D7;&#x4E00;&#x500B; callback &#x4E26;&#x56DE;&#x50B3;&#x4E00;&#x500B; <code>unsubscribe</code> function&#x3002;</p><ul><li><code>callback(input): Function</code> - callback&#xFF08;&#x900F;&#x904E; runSaga &#x63D0;&#x4F9B;&#xFF09;&#x88AB;&#x7528;&#x4F86;&#x8A02;&#x95B1;&#x8F38;&#x5165;&#x4E8B;&#x4EF6;&#x3002;<code>subscribe</code> &#x5FC5;&#x9808;&#x652F;&#x63F4;&#x8A3B;&#x518A;&#x591A;&#x500B;&#x8A02;&#x95B1;&#x3002;
<ul><li><code>input: any</code> - &#x7531; <code>subscribe</code> &#x50B3;&#x9001;&#x53C3;&#x6578;&#x5230; <code>callback</code>&#xFF08;&#x53C3;&#x8003;&#x4E0B;&#x9762;&#x6CE8;&#x610F;&#x4E8B;&#x9805;&#xFF09;&#x3002;
</li></ul>
</li></ul>
</li></ul>
</li></ul>
<ul><li><p><code>dispatch(output): Function</code> - &#x7528;&#x4F86;&#x6EFF;&#x8DB3; <code>put</code> effect&#x3002;</p><ul><li><code>output: any</code> -  &#x7531; Saga &#x63D0;&#x4F9B;&#x7684;&#x53C3;&#x6578;&#x7D66; <code>put</code> Effect&#xFF08;&#x53C3;&#x8003;&#x4E0B;&#x9762;&#x6CE8;&#x610F;&#x4E8B;&#x9805;&#xFF09;&#x3002;
</li></ul>
</li>
<li><p><code>getState(): Function</code> - &#x7528;&#x4F86;&#x6EFF;&#x8DB3; <code>select</code> &#x548C; <code>getState</code> effect&#x3002;</p></li>
<li><p><code>sagaMonitor</code> : <a href="#sagamonitor">SagaMonitor</a> - &#x53C3;&#x8003; <a href="#createsagamiddlewareoptions"><code>createSagaMiddleware(options)</code></a> &#x6587;&#x4EF6;&#x3002;</p></li>
<li><p><code>logger: Function</code> - &#x53C3;&#x8003; <a href="#createsagamiddlewareoptions"><code>createSagaMiddleware(options)</code></a> &#x6587;&#x4EF6;</p></li>
<li><p><code>onError: Function</code> - &#x53C3;&#x8003; <a href="#createsagamiddlewareoptions"><code>createSagaMiddleware(options)</code></a> &#x6587;&#x4EF6;</p></li></ul>
<ul><li><p><code>saga: Function</code> - &#x4E00;&#x500B; Generator function</p></li>
<li><p><code>args: Array<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>any</span><span class="token punctuation">&gt;</span></span></code> - &#x63D0;&#x4F9B;&#x7D66; <code>saga</code> &#x7684;&#x53C3;&#x6578;</p></li></ul>
<h4 id="&#x6CE8;&#x610F;">&#x6CE8;&#x610F;</h4><p><code>{subscribe, dispatch}</code> &#x88AB;&#x7528;&#x4F86;&#x5B8C;&#x6210; <code>take</code> &#x548C; <code>put</code> Effects&#xFF0C;&#x5B9A;&#x7FA9; Saga &#x8F38;&#x5165;&#x548C;&#x8F38;&#x51FA;&#x7684;&#x4ECB;&#x9762;&#xFF08;interface&#xFF09;&#x3002;</p><p><code>subscribe</code> &#x88AB;&#x7528;&#x4F86;&#x5B8C;&#x6210; <code>take(PATTERN)</code> effects&#xFF0C;&#x5728;&#x6BCF;&#x6B21;&#x6709;&#x4E00;&#x500B;&#x8F38;&#x5165;&#x88AB; dispatch &#x6642;&#xFF0C;&#x547C;&#x53EB; <code>callback</code>&#xFF08;&#x4F8B;&#x5982;&#xFF1A;&#x5982;&#x679C; Saga &#x88AB;&#x9023;&#x7D50;&#x5230; DOM &#x9EDE;&#x64CA;&#x4E8B;&#x4EF6;&#xFF0C;&#x5728;&#x6BCF;&#x6B21;&#x6ED1;&#x9F20;&#x9EDE;&#x64CA;&#x6642;&#xFF09;&#x3002;
&#x6BCF;&#x6B21; <code>subscribe</code> &#x767C;&#x51FA;&#x4E00;&#x500B;&#x8F38;&#x5165;&#x5230;&#x5B83;&#x7684; callback&#xFF0C;&#x5982;&#x679C; Saga &#x88AB;&#x963B;&#x585E;&#x5728; <code>take</code> effect &#x800C;&#x4E14;&#x5982;&#x679C;&#x76EE;&#x524D;&#x50B3;&#x5165;&#x7684;&#x8F38;&#x5165;&#x7B26;&#x5408; take pattern&#xFF0C;Saga &#x6062;&#x5FA9;&#x8A72;&#x8F38;&#x5165;&#x3002;</p><p><code>dispatch</code> &#x88AB;&#x7528;&#x4F86;&#x5B8C;&#x6210; <code>put</code> effects&#x3002;&#x6BCF;&#x6B21; Saga &#x767C;&#x51FA;&#x4E00;&#x500B; <code>yield put(output)</code>&#xFF0C;<code>dispatch</code> &#x88AB;&#x8ABF;&#x7528;&#x5230;&#x8A72;&#x8F38;&#x51FA;&#x3002;</p><h2 id="utils">Utils</h2><h3 id="channelbuffer"><code>channel([buffer])</code></h3><p>&#x4E00;&#x500B; factory &#x65B9;&#x6CD5;&#x88AB;&#x7528;&#x4F86;&#x5EFA;&#x7ACB; Channel&#x3002;&#x4F60;&#x4E5F;&#x53EF;&#x4EE5;&#x9078;&#x64C7;&#x50B3;&#x9001; buffer &#x53BB;&#x63A7;&#x5236; channel buffer &#x7684;&#x8A0A;&#x606F;&#x3002;</p><p>&#x9810;&#x8A2D;&#x4E0A;&#xFF0C;&#x5982;&#x679C;&#x6C92;&#x6709;&#x63D0;&#x4F9B;&#x7DE9;&#x885D;&#xFF0C;channel &#x6700;&#x591A;&#x5C07;&#x968A;&#x5217; 10 &#x7B46;&#x50B3;&#x5165;&#x7684;&#x8A0A;&#x606F;&#xFF0C;&#x76F4;&#x5230; taker &#x88AB;&#x8A3B;&#x518A;&#x3002;&#x9810;&#x8A2D;&#x7DE9;&#x885D;&#x63A1;&#x7528; FIFO &#x7B56;&#x7565;&#x4F86;&#x50B3;&#x905E;&#x8A0A;&#x606F;&#xFF1A;&#x4E00;&#x500B;&#x65B0;&#x7684; taker &#x5C07;&#x50B3;&#x905E;&#x5728;&#x7DE9;&#x885D;&#x5167;&#x6700;&#x820A;&#x7684;&#x8A0A;&#x606F;&#x3002;</p><h3 id="eventchannelsubscribe-buffer-matcher"><code>eventChannel(subscribe, [buffer], [matcher])</code></h3><p>&#x5EFA;&#x7ACB; channel &#x4F7F;&#x7528; <code>subscribe</code> &#x65B9;&#x6CD5;&#x4F86;&#x8A02;&#x95B1;&#x4E8B;&#x4EF6;&#x4F86;&#x6E90;&#x3002;&#x5F9E;&#x4E8B;&#x4EF6;&#x4F86;&#x6E90;&#x50B3;&#x5165;&#x7684;&#x4E8B;&#x4EF6;&#x5728; channel &#x5C07;&#x88AB;&#x968A;&#x5217;&#xFF0C;&#x76F4;&#x5230;&#x6709; taker &#x88AB;&#x8A3B;&#x518A;&#x3002;</p><ul><li><p><code>subscribe: Function</code> function &#x5FC5;&#x9808;&#x56DE;&#x50B3;&#x4E00;&#x500B;&#x53D6;&#x6D88;&#x8A02;&#x95B1;&#xFF08;unsubscribe&#xFF09;&#x7684; function &#x4F86;&#x7D50;&#x675F;&#x8A02;&#x95B1;&#x3002;</p></li>
<li><p><code>buffer: Buffer</code> &#x53EF;&#x9078;&#x7684; Buffer &#x7269;&#x4EF6;&#x5728;&#x9019;&#x500B; channel &#x7DE9;&#x885D;&#x8A0A;&#x606F;&#x3002;&#x5982;&#x679C;&#x6C92;&#x6709;&#x63D0;&#x4F9B;&#x8A0A;&#x606F;&#xFF0C;&#x5728;&#x9019;&#x500B; channel &#x5C07;&#x4E0D;&#x6703;&#x88AB;&#x7DE9;&#x885D;</p></li>
<li><p><code>matcher: Function</code> &#x53EF;&#x9078;&#x7684;&#x65B7;&#x8A00;&#xFF08;predicate&#xFF09; function&#xFF08;<code>any =&gt; Boolean</code>&#xFF09; &#x904E;&#x6FFE;&#x50B3;&#x5165;&#x7684;&#x8A0A;&#x606F;&#x3002;&#x53EA;&#x6709;&#x88AB; matcher &#x63A5;&#x53D7;&#x7684;&#x8A0A;&#x624D;&#x6703;&#x88AB;&#x653E;&#x5230; channel&#x3002;</p></li></ul>
<p>&#x901A;&#x77E5; channel &#x4E8B;&#x4EF6;&#x4F86;&#x6E90;&#x88AB;&#x7D42;&#x6B62;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x7528;&#x4E00;&#x500B; <code>END</code> &#x901A;&#x77E5;&#x88AB;&#x63D0;&#x4F9B;&#x7684;&#x8A02;&#x95B1;&#x8005;&#x3002;</p><h4 id="&#x7BC4;&#x4F8B;">&#x7BC4;&#x4F8B;</h4><p>&#x5728;&#x4EE5;&#x4E0B;&#x7BC4;&#x4F8B;&#x6211;&#x5011;&#x5EFA;&#x7ACB;&#x4E00;&#x500B;&#x4E8B;&#x4EF6; channel &#x5C07;&#x8A02;&#x95B1; <code>setInterval</code>&#xFF1A;</p><pre><code class="lang-javascript"><span class="token keyword">const</span> countdown <span class="token operator">=</span> <span class="token punctuation">(</span>secs<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">eventChannel</span><span class="token punctuation">(</span>emitter <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> iv <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;countdown&apos;</span><span class="token punctuation">,</span> secs<span class="token punctuation">)</span>
        secs <span class="token operator">-</span><span class="token operator">=</span> <span class="token number">1</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>secs <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">emitter</span><span class="token punctuation">(</span>secs<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token function">emitter</span><span class="token punctuation">(</span>END<span class="token punctuation">)</span>
          <span class="token function">clearInterval</span><span class="token punctuation">(</span>iv<span class="token punctuation">)</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;countdown terminated&apos;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">clearInterval</span><span class="token punctuation">(</span>iv<span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;countdown cancelled&apos;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="buffers"><code>buffers</code></h3><p>&#x63D0;&#x4F9B;&#x4E00;&#x4E9B;&#x5E38;&#x898B;&#x7684; buffer</p><ul><li><p><code>buffers.none()</code>: &#x5982;&#x679C;&#x6C92;&#x6709;&#x7B49;&#x5F85;&#x7684; taker&#xFF0C;&#x65B0;&#x8A0A;&#x606F;&#x5C07;&#x6703;&#x907A;&#x5931;&#x3002;</p></li>
<li><p><code>buffers.fixed(limit)</code>: &#x65B0;&#x7684;&#x8A0A;&#x606F;&#x5C07;&#x6703;&#x88AB;&#x7DE9;&#x885D;&#x76F4;&#x5230; <code>limit</code> &#x4E0A;&#x9650;&#x3002;Overflow &#x5C07;&#x6703;&#x5F15;&#x767C;&#x4E00;&#x500B;&#x932F;&#x8AA4;&#x3002;&#x7701;&#x7565; <code>limit</code> &#x5C07;&#x6703;&#x5C0E;&#x81F4;&#x53EA;&#x80FD;&#x7DE9;&#x885D; 10 &#x7B46;&#x7684;&#x8A0A;&#x606F;&#x3002;</p></li>
<li><p><code>buffers.expanding(initialSize)</code>: &#x985E;&#x4F3C; <code>fixed</code>&#xFF0C;&#x4F46;&#x662F; Overflow &#x5C07;&#x6703;&#x9020;&#x6210;&#x7DE9;&#x885D;&#x52D5;&#x614B;&#x7684;&#x64F4;&#x5C55;&#x3002;</p></li>
<li><p><code>buffers.dropping(limit)</code>: &#x76F8;&#x540C;&#x65BC; <code>fixed</code>&#xFF0C;&#x4F46;&#x662F; Overflow &#x5C07;&#x6703;&#x76F4;&#x63A5;&#x7684;&#x4E1F;&#x68C4;&#x8A0A;&#x606F;&#x3002;</p></li>
<li><p><code>buffers.sliding(limit)</code>: &#x76F8;&#x540C;&#x65BC; <code>fixed</code>&#xFF0C;&#x4F46;&#x662F; Overflow &#x5C07;&#x6703;&#x5728;&#x5C3E;&#x90E8;&#x65B0;&#x589E;&#x65B0;&#x8A0A;&#x606F;&#xFF0C;&#x4E26;&#x4E1F;&#x68C4;&#x5728;&#x7DE9;&#x885D;&#x5167;&#x6700;&#x820A;&#x7684;&#x8A0A;&#x606F;&#x3002;</p></li></ul>
<h3 id="delayms-val"><code>delay(ms, [val])</code></h3><p>&#x56DE;&#x50B3;&#x4E00;&#x500B; Promise&#xFF0C;&#x5C07;&#x5728; <code>ms</code> &#x6BEB;&#x79D2;&#x5F8C; resolve <code>val</code>&#x3002;</p><h3 id="cloneablegeneratorgeneratorfunc"><code>cloneableGenerator(generatorFunc)</code></h3><p>&#x5E36;&#x4E86;&#x4E00;&#x500B; generator function&#xFF08;function*&#xFF09;&#x4E26;&#x56DE;&#x50B3;&#x4E00;&#x500B; generator function&#x3002;
&#x6240;&#x6709;&#x5F9E;&#x9019;&#x500B; function &#x5BE6;&#x4F8B;&#x5316;&#x7684; generator &#x90FD;&#x53EF;&#x4EE5;&#x53EF;&#x4EE5;&#x88AB; clone&#x3002;
&#x50C5;&#x7528;&#x65BC;&#x6E2C;&#x8A66;&#x3002;</p><h4 id="&#x7BC4;&#x4F8B;">&#x7BC4;&#x4F8B;</h4><p>&#x7576;&#x4F60;&#x60F3;&#x8981;&#x6E2C;&#x8A66;&#x4E0D;&#x540C;&#x7684; saga branch &#x7684;&#x6642;&#x5019;&#x5F88;&#x6709;&#x7528;&#x7684;&#xFF0C;&#x4F60;&#x4E0D;&#x9700;&#x8981;&#x91CD;&#x8907;&#x9019;&#x4E9B;&#x52D5;&#x4F5C;&#x3002;</p><pre><code class="lang-javascript">
<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">oddOrEven</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// &#x4E00;&#x4E9B;&#x6771;&#x897F;&#x5728;&#x9019;&#x88E1;&#x5B8C;&#x6210;&#x4E86;</span>
  <span class="token keyword">yield</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token number">3</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> userInput <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token string">&apos;enter a number&apos;</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>userInput <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">yield</span> <span class="token string">&apos;even&apos;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">yield</span> <span class="token string">&apos;odd&apos;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&apos;my oddOrEven saga&apos;</span><span class="token punctuation">,</span> assert <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  data<span class="token punctuation">.</span>gen <span class="token operator">=</span> <span class="token function">cloneableGenerator</span><span class="token punctuation">(</span>oddOrEven<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>
    data<span class="token punctuation">.</span>gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">,</span>
    <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token string">&apos;it should yield 1&apos;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>
    data<span class="token punctuation">.</span>gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">,</span>
    <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token string">&apos;it should yield 2&apos;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>
    data<span class="token punctuation">.</span>gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">,</span>
    <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token string">&apos;it should yield 3&apos;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>
    data<span class="token punctuation">.</span>gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">,</span>
    <span class="token string">&apos;enter a number&apos;</span><span class="token punctuation">,</span>
    <span class="token string">&apos;it should ask for a number&apos;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  assert<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&apos;even number is given&apos;</span><span class="token punctuation">,</span> a <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// &#x5728;&#x7D66;&#x51FA;&#x4E00;&#x500B; number &#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x5011;&#x88FD;&#x4F5C;&#x4E00;&#x500B; clone &#x7684; generator&#xFF1B;</span>
    data<span class="token punctuation">.</span>clone <span class="token operator">=</span> data<span class="token punctuation">.</span>gen<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    a<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>
      data<span class="token punctuation">.</span>gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">,</span>
      <span class="token string">&apos;even&apos;</span><span class="token punctuation">,</span>
      <span class="token string">&apos;it should yield &quot;event&quot;&apos;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    a<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>
      data<span class="token punctuation">.</span>gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>done<span class="token punctuation">,</span>
      <span class="token keyword">true</span><span class="token punctuation">,</span>
      <span class="token string">&apos;it should be done&apos;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    a<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  assert<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&apos;odd number is given&apos;</span><span class="token punctuation">,</span> a <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>

    a<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>
      data<span class="token punctuation">.</span>clone<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">,</span>
      <span class="token string">&apos;odd&apos;</span><span class="token punctuation">,</span>
      <span class="token string">&apos;it should yield &quot;odd&quot;&apos;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    a<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>
      data<span class="token punctuation">.</span>clone<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>done<span class="token punctuation">,</span>
      <span class="token keyword">true</span><span class="token punctuation">,</span>
      <span class="token string">&apos;it should be done&apos;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    a<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  assert<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="createmocktask"><code>createMockTask()</code></h3><p>&#x56DE;&#x50B3;&#x4E00;&#x500B; mock task &#x7684;&#x7269;&#x4EF6;&#x3002;
&#x50C5;&#x7528;&#x65BC;&#x6E2C;&#x8A66;&#x76EE;&#x7684;&#xFF0C;
<a href="../advanced/TaskCancellation.html#testing-generators-with-fork-effect">&#x8A73;&#x7D30;&#x8CC7;&#x8A0A;&#x8ACB;&#x53C3;&#x8003; Task Cancellation &#x6587;&#x4EF6;&#x3002;</a>
)</p><h2 id="cheatsheets">Cheatsheets</h2><h3 id="blocking--non-blocking">Blocking / Non-blocking</h3><table>
<thead>
<tr><th>Name</th>
<th>Blocking</th>
</tr></thead><tbody>
<tr><td>takeEvery</td>
<td>No</td>
</tr><tr><td>takeLatest</td>
<td>No</td>
</tr><tr><td>throttle</td>
<td>No</td>
</tr><tr><td>take</td>
<td>Yes</td>
</tr><tr><td>take(channel)</td>
<td>Sometimes (see API reference)</td>
</tr><tr><td>take.maybe</td>
<td>Yes</td>
</tr><tr><td>put</td>
<td>No</td>
</tr><tr><td>put.resolve</td>
<td>Yes</td>
</tr><tr><td>put(channel, action)</td>
<td>No</td>
</tr><tr><td>call</td>
<td>Yes</td>
</tr><tr><td>apply</td>
<td>Yes</td>
</tr><tr><td>cps</td>
<td>Yes</td>
</tr><tr><td>fork</td>
<td>No</td>
</tr><tr><td>spawn</td>
<td>No</td>
</tr><tr><td>join</td>
<td>Yes</td>
</tr><tr><td>cancel</td>
<td>No</td>
</tr><tr><td>select</td>
<td>No</td>
</tr><tr><td>actionChannel</td>
<td>No</td>
</tr><tr><td>flush</td>
<td>Yes</td>
</tr><tr><td>cancelled</td>
<td>Yes</td>
</tr><tr><td>race</td>
<td>Yes</td>
</tr><tr><td>all</td>
<td>Blocks if there is a blocking effect in the array or object</td>
</tr></tbody></table>


                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../Glossary.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: 7. 術語表">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"8. API 參考","level":"1.9","depth":1,"previous":{"title":"7. 術語表","level":"1.8","depth":1,"path":"docs/Glossary.md","ref":"docs/Glossary.md","articles":[]},"dir":"ltr"},"config":{"plugins":["prism@1.0.0","-highlight","github","favicon"],"styles":{"website":"build/gitbook.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"github":{"url":"https://github.com/redux-saga/redux-saga/"},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"build/gitbook.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"favicon":{"shortcut":"logo/favicon/favicon.ico","bookmark":"logo/favicon/favicon.ico","appleTouch":"logo/favicon/apple-touch-icon-152x152.png","appleTouchMore":{"120x120":"logo/favicon/apple-touch-icon-120x120.png","180x180":"logo/favicon/apple-touch-icon-180x180.png"}},"prism":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Redux-Saga","gitbook":"3.2.0"},"file":{"path":"docs/api/README.md","mtime":"2017-11-29T03:42:03.000Z","type":"markdown"},"gitbook":{"version":"3.2.0","time":"2017-11-29T03:43:15.856Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

